<!DOCTYPE html><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="generator" content="Asciidoctor 0.1.4"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Composable Roles Lab</title><style>@import url(http://cdnjs.cloudflare.com/ajax/libs/font-awesome/3.2.0/css/font-awesome.css);
/*! normalize.css v2.1.2 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }

/** Address `[hidden]` styling not present in IE 8/9. Hide the `template` element in IE, Safari, and Firefox < 22. */
[hidden], template { display: none; }

script { display: none !important; }

/* ========================================================================== Base ========================================================================== */
/** 1. Set default font family to sans-serif. 2. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { font-family: sans-serif; /* 1 */ -ms-text-size-adjust: 100%; /* 2 */ -webkit-text-size-adjust: 100%; /* 2 */ }

/** Remove default margin. */
body { margin: 0; }

/* ========================================================================== Links ========================================================================== */
/** Remove the gray background color from active links in IE 10. */
a { background: transparent; }

/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 2em; margin: 0.67em 0; }

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: bold; }

/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }

/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }

/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }

/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }

/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }

/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sup { top: -0.5em; }

sub { bottom: -0.25em; }

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }

meta.foundation-mq-small { font-family: "only screen and (min-width: 768px)"; width: 768px; }

meta.foundation-mq-medium { font-family: "only screen and (min-width:1280px)"; width: 1280px; }

meta.foundation-mq-large { font-family: "only screen and (min-width:1440px)"; width: 1440px; }

*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }

html, body { font-size: 100%; }

body { background: white; color: #222222; padding: 0; margin: 0; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }

a:hover { cursor: pointer; }

img, object, embed { max-width: 100%; height: auto; }

object, embed { height: 100%; }

img { -ms-interpolation-mode: bicubic; }

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }

.left { float: left !important; }

.right { float: right !important; }

.text-left { text-align: left !important; }

.text-right { text-align: right !important; }

.text-center { text-align: center !important; }

.text-justify { text-align: justify !important; }

.hide { display: none; }

.antialiased, body { -webkit-font-smoothing: antialiased; }

img { display: inline-block; vertical-align: middle; }

textarea { height: auto; min-height: 50px; }

select { width: 100%; }

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }

.subheader, #content #toctitle, .admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .mathblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title, .tableblock > caption { line-height: 1.4; color: #003b6b; font-weight: 300; margin-top: 0.2em; margin-bottom: 0.5em; }

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }

/* Default Link Styles */
a { color: #00579e; text-decoration: none; line-height: inherit; }
a:hover, a:focus { color: #333333; }
a img { border: none; }

/* Default paragraph styles */
p { font-family: Arial, sans-serif; font-weight: normal; font-size: 1em; line-height: 1.6; margin-bottom: 0.75em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: Arial, sans-serif; font-weight: normal; font-style: normal; color: #7b2d00; text-rendering: optimizeLegibility; margin-top: 0.5em; margin-bottom: 0.5em; line-height: 1.2125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #ff6b15; line-height: 0; }

h1 { font-size: 2.125em; }

h2 { font-size: 1.6875em; }

h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }

h4 { font-size: 1.125em; }

h5 { font-size: 1.125em; }

h6 { font-size: 1em; }

hr { border: solid #dddddd; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }

/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }

strong, b { font-weight: bold; line-height: inherit; }

small { font-size: 60%; line-height: inherit; }

code { font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: bold; color: #003426; }

/* Lists */
ul, ol, dl { font-size: 1em; line-height: 1.6; margin-bottom: 0.75em; list-style-position: outside; font-family: Arial, sans-serif; }

ul, ol { margin-left: 1.5em; }
ul.no-bullet, ol.no-bullet { margin-left: 1.5em; }

/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */ }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }

/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }

/* Definition Lists */
dl dt { margin-bottom: 0.3em; font-weight: bold; }
dl dd { margin-bottom: 0.75em; }

/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: black; border-bottom: 1px dotted #dddddd; cursor: help; }

abbr { text-transform: none; }

/* Blockquotes */
blockquote { margin: 0 0 0.75em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: 0.8125em; color: #e15200; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #e15200; }

blockquote, blockquote p { line-height: 1.6; color: #333333; }

/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }

.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }

@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }
/* Print styles.  Inlined to avoid required HTTP connection: www.phpied.com/delay-loading-your-print-css/ Credit to Paul Irish and HTML5 Boilerplate (html5boilerplate.com)
*/
.print-only { display: none !important; }

@media print { * { background: transparent !important; color: #000 !important; /* Black prints faster: h5bp.com/s */ box-shadow: none !important; text-shadow: none !important; }
  a, a:visited { text-decoration: underline; }
  a[href]:after { content: " (" attr(href) ")"; }
  abbr[title]:after { content: " (" attr(title) ")"; }
  .ir a:after, a[href^="javascript:"]:after, a[href^="#"]:after { content: ""; }
  pre, blockquote { border: 1px solid #999; page-break-inside: avoid; }
  thead { display: table-header-group; /* h5bp.com/t */ }
  tr, img { page-break-inside: avoid; }
  img { max-width: 100% !important; }
  @page { margin: 0.5cm; }
  p, h2, h3, #toctitle, .sidebarblock > .content > .title { orphans: 3; widows: 3; }
  h2, h3, #toctitle, .sidebarblock > .content > .title { page-break-after: avoid; }
  .hide-on-print { display: none !important; }
  .print-only { display: block !important; }
  .hide-for-print { display: none !important; }
  .show-for-print { display: inherit !important; } }
/* Tables */
table { background: white; margin-bottom: 1.25em; border: solid 1px #d8d8ce; }
/* Change -webkit-linear-gradient colors to  #a70000 and remove gradient */
table thead, table tfoot { background: -webkit-linear-gradient(top, #a70000, #a70000); font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: white; text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: #6d6e71; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #edf2f2; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.4; }

a:hover, a:focus { text-decoration: underline; }

.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }

*:not(pre) > code { font-size: inherit; padding: 3px 2px 1px 2px; white-space: nowrap; background-color: #eeeeee; border: 1px solid #dddddd; -webkit-border-radius: 0; border-radius: 0; text-shadow: none; }

pre, pre > code { line-height: 1.6; color: black; font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: normal; }

kbd.keyseq { color: #333333; }

kbd:not(.keyseq) { display: inline-block; color: black; font-size: 0.75em; line-height: 1.4; background-color: #F7F7F7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset; margin: -0.15em 0.15em 0 0.15em; padding: 0.2em 0.6em 0.2em 0.5em; vertical-align: middle; white-space: nowrap; }

kbd kbd:first-child { margin-left: 0; }

kbd kbd:last-child { margin-right: 0; }

.menuseq, .menu { color: black; }

b.button:before { content: '[ '; }

b.button:after { content: ' ]'; }

#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 1.5em; padding-right: 1.5em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }

#header { margin-bottom: 2.5em; }
#header > h1 { color: #7b2d00; font-weight: normal; border-bottom: 1px solid #dddddd; margin-bottom: -28px; padding-bottom: 32px; }
#header span { color: #333333; }
#header #revnumber { text-transform: capitalize; }
#header br { display: none; }
#header br + span { padding-left: 3px; }
#header br + span:before { content: "\2013 \0020"; }
#header br + span.author { padding-left: 0; }
#header br + span.author:before { content: ", "; }

#toc { border-bottom: 1px solid #dddddd; padding-bottom: 1.25em; }
#toc > ul { margin-left: 0.25em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
#toc ul { list-style-type: none; }

#toctitle { color: #003b6b; }

@media only screen and (min-width: 768px) { body.toc2 { padding-left: 15em; padding-right: 0; }
  #toc.toc2 { position: fixed; width: 15em; left: 0; top: 0; border-right: 1px solid #dddddd; border-bottom: 0; z-index: 1000; padding: 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; font-size: 1.2em; }
  #toc.toc2 > ul { font-size: .90em; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 15em; }
  body.toc2.toc-right #toc.toc2 { border-right: 0; border-left: 1px solid #dddddd; left: auto; right: 0; } }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; padding-right: 0; }
  #toc.toc2 { width: 20em; }
  #toc.toc2 #toctitle { font-size: 1.375em; }
  #toc.toc2 > ul { font-size: 0.95em; }
  #toc.toc2 ul ul { padding-left: 1.25em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; border-width: 0; -webkit-border-radius: 0; border-radius: 0; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }
#content #toc a { text-decoration: none; }

#content #toctitle { font-weight: bold; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-size: 1em; padding-left: 0.125em; }

#footer { max-width: 100%; background-color: none; padding: 1.25em; }

#footer-text { color: black; line-height: 1.44; }

.sect1 { padding-bottom: 1.25em; }

.sect1 + .sect1 { border-top: 1px solid #dddddd; }

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; width: 1em; margin-left: -1em; display: block; text-decoration: none; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: '\00A7'; font-size: .85em; vertical-align: text-top; display: block; margin-top: 0.05em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #7b2d00; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #622400; }

.imageblock, .literalblock, .listingblock, .mathblock, .verseblock, .videoblock { margin-bottom: 1.25em; }

.admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .mathblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-align: left; font-weight: bold; }

.tableblock > caption { text-align: left; font-weight: bold; white-space: nowrap; overflow: visible; max-width: 0; }

table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }

.admonitionblock > table { border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #dddddd; color: #333333; }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }

.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 0; border-radius: 0; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }
.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6, .exampleblock > .content p { color: #333333; }
.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6 { line-height: 1; margin-bottom: 0.625em; }
.exampleblock > .content h1.subheader, .exampleblock > .content h2.subheader, .exampleblock > .content h3.subheader, .exampleblock > .content .subheader#toctitle, .sidebarblock.exampleblock > .content > .subheader.title, .exampleblock > .content h4.subheader, .exampleblock > .content h5.subheader, .exampleblock > .content h6.subheader { line-height: 1.4; }

.exampleblock.result > .content { -webkit-box-shadow: 0 1px 8px #aaaaaa; box-shadow: 0 1px 8px #aaaaaa; }

.sidebarblock { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 0; border-radius: 0; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6, .sidebarblock p { color: #333333; }
.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6 { line-height: 1; margin-bottom: 0.625em; }
.sidebarblock h1.subheader, .sidebarblock h2.subheader, .sidebarblock h3.subheader, .sidebarblock .subheader#toctitle, .sidebarblock > .content > .subheader.title, .sidebarblock h4.subheader, .sidebarblock h5.subheader, .sidebarblock h6.subheader { line-height: 1.4; }
.sidebarblock > .content > .title { color: #003b6b; margin-top: 0; line-height: 1.6; }

.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }

.literalblock pre:not([class]), .listingblock pre:not([class]) { background: #eeeeee; }
.literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { border-width: 1px; border-style: dashed; border-color: #666666; -webkit-border-radius: 0; border-radius: 0; padding: 1.25em 1.5625em 1.125em 1.5625em; word-wrap: break-word; }
.literalblock pre.nowrap, .literalblock pre[class].nowrap, .listingblock pre.nowrap, .listingblock pre[class].nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
.literalblock pre > code, .literalblock pre[class] > code, .listingblock pre > code, .listingblock pre[class] > code { display: block; }
@media only screen { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.72em; } }
@media only screen and (min-width: 768px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.81em; } }
@media only screen and (min-width: 1280px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.9em; } }

.listingblock pre.highlight { padding: 0; }
.listingblock pre.highlight > code { padding: 1.25em 1.5625em 1.125em 1.5625em; }

.listingblock > .content { position: relative; }

.listingblock:hover code[class*=" language-"]:before { text-transform: uppercase; font-size: 0.9em; color: #999; position: absolute; top: 0.375em; right: 0.375em; }

.listingblock:hover code.asciidoc:before { content: "asciidoc"; }
.listingblock:hover code.clojure:before { content: "clojure"; }
.listingblock:hover code.css:before { content: "css"; }
.listingblock:hover code.groovy:before { content: "groovy"; }
.listingblock:hover code.html:before { content: "html"; }
.listingblock:hover code.java:before { content: "java"; }
.listingblock:hover code.javascript:before { content: "javascript"; }
.listingblock:hover code.python:before { content: "python"; }
.listingblock:hover code.ruby:before { content: "ruby"; }
.listingblock:hover code.sass:before { content: "sass"; }
.listingblock:hover code.scss:before { content: "scss"; }
.listingblock:hover code.xml:before { content: "xml"; }
.listingblock:hover code.yaml:before { content: "yaml"; }

.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }

.listingblock.terminal pre .command:not([data-prompt]):before { content: '$'; }

table.pyhltable { border: 0; margin-bottom: 0; }

table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; }

table.pyhltable td.code { padding-left: .75em; padding-right: 0; }

.highlight.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #dddddd; }

.highlight.pygments .lineno { display: inline-block; margin-right: .25em; }

table.pyhltable .linenodiv { background-color: transparent !important; padding-right: 0 !important; }

.quoteblock { margin: 0 0 0.75em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
.quoteblock blockquote { margin: 0 0 0.75em 0; padding: 0 0 0.5625em 0; border: 0; }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: -.25em; padding-bottom: 0.5625em; font-size: 0.8125em; color: #e15200; }
.quoteblock .attribution br { display: none; }
.quoteblock .attribution cite { display: block; margin-bottom: 0.625em; }

table thead th, table tfoot th { font-weight: bold; }

table.tableblock.grid-all { border-collapse: separate; border-spacing: 1px; -webkit-border-radius: 0; border-radius: 0; border-top: 1px solid #dddddd; border-bottom: 1px solid #dddddd; }

table.tableblock.frame-topbot, table.tableblock.frame-none { border-left: 0; border-right: 0; }

table.tableblock.frame-sides, table.tableblock.frame-none { border-top: 0; border-bottom: 0; }

table.tableblock td .paragraph:last-child p > p:last-child, table.tableblock th > p:last-child, table.tableblock td > p:last-child { margin-bottom: 0; }

th.tableblock.halign-left, td.tableblock.halign-left { text-align: left; }

th.tableblock.halign-right, td.tableblock.halign-right { text-align: right; }

th.tableblock.halign-center, td.tableblock.halign-center { text-align: center; }

th.tableblock.valign-top, td.tableblock.valign-top { vertical-align: top; }

th.tableblock.valign-bottom, td.tableblock.valign-bottom { vertical-align: bottom; }

th.tableblock.valign-middle, td.tableblock.valign-middle { vertical-align: middle; }

tbody tr th { display: table-cell; line-height: 1.4; background: -webkit-linear-gradient(top, #add386, #90b66a); }

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p { color: white; font-weight: bold; }

td > div.verse { white-space: pre; }

ol { margin-left: 1.75em; }

ul li ol { margin-left: 1.5em; }

dl dd { margin-left: 1.125em; }

dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.375em; }

ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }

ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }

ul.checklist li > p:first-child > i[class^="icon-check"]:first-child, ul.checklist li > p:first-child > input[type="checkbox"]:first-child { margin-right: 0.25em; }

ul.checklist li > p:first-child > input[type="checkbox"]:first-child { position: relative; top: 1px; }

ul.inline { margin: 0 auto 0.375em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }

.unstyled dl dt { font-weight: normal; font-style: normal; }

ol.arabic { list-style-type: decimal; }

ol.decimal { list-style-type: decimal-leading-zero; }

ol.loweralpha { list-style-type: lower-alpha; }

ol.upperalpha { list-style-type: upper-alpha; }

ol.lowerroman { list-style-type: lower-roman; }

ol.upperroman { list-style-type: upper-roman; }

ol.lowergreek { list-style-type: lower-greek; }

.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }

td.hdlist1 { padding-right: .8em; font-weight: bold; }

td.hdlist1, td.hdlist2 { vertical-align: top; }

.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }

.colist > table tr > td:first-of-type { padding: 0 .8em; line-height: 1; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }

.qanda > ol > li > p > em:only-child { color: #004985; }

.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }

.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }

.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }

a.image { text-decoration: none; }

span.footnote, span.footnoteref { vertical-align: super; font-size: 0.875em; }
span.footnote a, span.footnoteref a { text-decoration: none; }

#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -.25em 0 .75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em; line-height: 1.3; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.2em; margin-bottom: .2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }

#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }

.gist .file-data > table { border: none; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }

div.unbreakable { page-break-inside: avoid; }

.big { font-size: larger; }

.small { font-size: smaller; }

.underline { text-decoration: underline; }

.overline { text-decoration: overline; }

.line-through { text-decoration: line-through; }

.aqua { color: #00bfbf; }

.aqua-background { background-color: #00fafa; }

.black { color: black; }

.black-background { background-color: black; }

.blue { color: #0000bf; }

.blue-background { background-color: #0000fa; }

.fuchsia { color: #bf00bf; }

.fuchsia-background { background-color: #fa00fa; }

.gray { color: #606060; }

.gray-background { background-color: #7d7d7d; }

.green { color: #006000; }

.green-background { background-color: #007d00; }

.lime { color: #00bf00; }

.lime-background { background-color: #00fa00; }

.maroon { color: #600000; }

.maroon-background { background-color: #7d0000; }

.navy { color: #000060; }

.navy-background { background-color: #00007d; }

.olive { color: #606000; }

.olive-background { background-color: #7d7d00; }

.purple { color: #600060; }

.purple-background { background-color: #7d007d; }

.red { color: #bf0000; }

.red-background { background-color: #fa0000; }

.silver { color: #909090; }

.silver-background { background-color: #bcbcbc; }

.teal { color: #006060; }

.teal-background { background-color: #007d7d; }

.white { color: #bfbfbf; }

.white-background { background-color: #fafafa; }

.yellow { color: #bfbf00; }

.yellow-background { background-color: #fafa00; }

span.icon > [class^="icon-"], span.icon > [class*=" icon-"] { cursor: default; }

.admonitionblock td.icon [class^="icon-"]:before { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #00579e; color: #004176; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }

.conum { display: inline-block; color: white !important; background-color: black; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; width: 20px; height: 20px; font-size: 12px; font-weight: bold; line-height: 20px; font-family: Arial, sans-serif; font-style: normal; position: relative; top: -2px; letter-spacing: -1px; }
.conum * { color: white !important; }
.conum + b { display: none; }
.conum:after { content: attr(data-value); }
.conum:not([data-value]):empty { display: none; }

h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { border-bottom: 1px solid #dddddd; }

#toctitle { color: #00406F; font-weight: normal; margin-top: 1.5em; }

.sidebarblock { border-color: #aaa; }

code { -webkit-border-radius: 4px; border-radius: 4px; }

p.tableblock.header { color: #6d6e71; }</style><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/3.2.0/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/sunburst.min.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script><script>hljs.initHighlightingOnLoad()</script></head><body class="article toc2 toc-left"><div id="header"><h1>Composable Roles Lab</h1><div id="toc" class="toc2"><div id="toctitle">Table of Contents</div><ul class="sectlevel1">
<li><a href="#_remove_overcloud">1. Remove Overcloud</a></li>
<li><a href="#_create_custom_roles_file">2. Create Custom Roles File</a></li>
<li><a href="#_customize_roles_and_network_data_files">3. Customize Roles and Network Data Files</a></li>
<li><a href="#_render_tripleo_templates">4. Render TripleO Templates</a></li>
<li><a href="#_customize_network_configuration_templates_for_selected_roles">5. Customize Network Configuration Templates for Selected Roles</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_select_appropriate_resource_registry_file">5.1. Select Appropriate Resource Registry File</a></li>
<li><a href="#_customize_nic_configuration_templates">5.2. Customize NIC Configuration Templates</a></li>
<li><a href="#_customize_network_environment_template">5.3. Customize Network Environment Template</a></li>
</ul>
</li>
<li><a href="#_define_node_counts_and_flavors">6. Define Node Counts and Flavors</a></li>
<li><a href="#_create_flavors_in_undercloud">7. Create Flavors in Undercloud</a></li>
<li><a href="#_assign_profiles_to_bare_metal_nodes">8. Assign Profiles to Bare Metal Nodes</a></li>
<li><a href="#_configure_fencing">9. Configure fencing</a></li>
<li><a href="#_deploying_the_overcloud">10. Deploying the Overcloud</a></li>
<li><a href="#_review_the_deployed_overcloud">11. Review the Deployed Overcloud</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_student_tasks">11.1. Student tasks</a></li>
<li><a href="#_provider_network">11.2. Provider network</a></li>
<li><a href="#_swift_configuration">11.3. Swift Configuration</a></li>
<li><a href="#_testing_evacuation_with_instance_ha">11.4. Testing Evacuation with Instance HA</a></li>
</ul>
</li>
</ul></div></div><div id="content"><div id="preamble"><div class="sectionbody"><div class="ulist"><div class="title">Goals</div><ul><li><p>Deploy an overcloud with a custom <em>Networker</em> role to offload OVNDBs.</p></li><li><p>Configure compute and networker nodes with the access to a new physical network over a separate OVS bridge.</p></li></ul></div></div></div>
<div class="sect1"><h2 id="_remove_overcloud">1. Remove Overcloud</h2><div class="sectionbody"><div class="paragraph"><p>Before you start the new deployment you need to remove previously deployed overcloud.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Login to the undercloud node and source the <code>~/stackrc</code> file:</p><div class="listingblock"><div class="title">[undercloud]</div><div class="content"><pre class="nowrap">[stack@undercloud ~]$ source ~/stackrc</pre></div></div></li><li><p>Remove the deployed overcloud:</p><div class="listingblock"><div class="title">[undercloud]</div><div class="content"><pre class="nowrap">(undercloud) [stack@undercloud ~]$ openstack overcloud delete overcloud --yes</pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre>Undeploying stack overcloud...
Waiting for messages on queue 'tripleo' with no timeout.
Deleting plan overcloud...
Success.</pre></div></div></li><li><p>Check that there is no plan anymore:</p><div class="listingblock"><div class="title">[undercloud]</div><div class="content"><pre class="nowrap">(undercloud) [stack@undercloud ~]$ openstack overcloud plan list</pre></div></div>
<div class="ulist"><ul><li><p>The output should be empty.</p></li></ul></div></li></ol></div></div></div>
<div class="sect1"><h2 id="_create_custom_roles_file">2. Create Custom Roles File</h2><div class="sectionbody"><div class="paragraph"><p>Red Hat OpenStack Platform 16 director supports a large number of composable TripleO <em>services</em>. There are grouped into a set of <em>roles</em>. The most knows are Controller, Compute, and storage roles but there are many more defined in the standard <code>roles_data.yaml</code>. You can get the full list using the <code>openstack overcloud role list</code> command. By creating a custom roles data file, you can select roles suitable for your overcloud and change composition of services in the selected roles.</p></div>
<div class="paragraph"><p>The network definitions are also composable in Red Hat OpenStack Platform 13. You can define a list of networks for each role. Also you can define new networks and their parameters and the <code>openstack overcloud deploy</code> command will automatically generate most of the required templates to configure them properly.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>List available roles:</p><div class="listingblock"><div class="title">[undercloud]</div><div class="content"><pre class="nowrap">[stack@undercloud ~]$ source ~/stackrc
(undercloud) [stack@undercloud ~]$ openstack overcloud role list</pre></div></div>
<div class="listingblock"><div class="title">Expected Output</div><div class="content"><pre class="nowrap">BlockStorage
CellController
CephAll
CephFile
CephObject
CephStorage
Compute
ComputeAlt
ComputeDVR
ComputeHCI
ComputeHCIOvsDpdk
ComputeInstanceHA
ComputeLiquidio
ComputeLocalEphemeral
ComputeOvsDpdk
ComputeOvsDpdkRT
ComputeOvsDpdkSriov
ComputeOvsDpdkSriovRT
ComputePPC64LE
ComputeRBDEphemeral
ComputeRealTime
ComputeSriov
ComputeSriovIB
ComputeSriovRT
Controller
ControllerAllNovaStandalone
ControllerNoCeph
ControllerNovaStandalone
ControllerOpenstack
ControllerStorageDashboard
ControllerStorageNfs
Database
DistributedCompute
DistributedComputeHCI
DistributedComputeHCIScaleOut
DistributedComputeScaleOut
HciCephAll
HciCephFile
HciCephMon
HciCephObject
IronicConductor
Messaging
Networker
Novacontrol
ObjectStorage
Standalone
Telemetry
Undercloud
UndercloudMinion</pre></div></div></li><li><p>It is possible to see details of each role. For example, review the <code>ComputeInstanceHA</code> role:</p><div class="listingblock"><div class="title">[undercloud]</div><div class="content"><pre class="nowrap">(undercloud) [stack@undercloud ~]$ openstack overcloud role show ComputeInstanceHA</pre></div></div>
<div class="listingblock"><div class="title">Expected Output</div><div class="content"><pre class="nowrap">###############################################################################
# Role Data for 'ComputeInstanceHA'
###############################################################################
CountDefault: '1'
HostnameFormatDefault: '%stackname%-novacomputeiha-%index%'
RoleParametersDefault: '{'TunedProfileName': 'virtual-host'}'
ServicesDefault:
 * OS::TripleO::Services::Aide
 * OS::TripleO::Services::AuditD
 * OS::TripleO::Services::BootParams
 * OS::TripleO::Services::CACerts
 * OS::TripleO::Services::CephClient
 * OS::TripleO::Services::CephExternal
 * OS::TripleO::Services::CertmongerUser
 * OS::TripleO::Services::Collectd
 * OS::TripleO::Services::ComputeCeilometerAgent
 * OS::TripleO::Services::ComputeInstanceHA
 * OS::TripleO::Services::ComputeNeutronCorePlugin
 * OS::TripleO::Services::ComputeNeutronL3Agent
 * OS::TripleO::Services::ComputeNeutronMetadataAgent
 * OS::TripleO::Services::ComputeNeutronOvsAgent
 * OS::TripleO::Services::podman
 * OS::TripleO::Services::IpaClient
 * OS::TripleO::Services::Ipsec
 * OS::TripleO::Services::Iscsid
 * OS::TripleO::Services::Kernel
 * OS::TripleO::Services::LoginDefs
 * OS::TripleO::Services::MetricsQdr
 * OS::TripleO::Services::Multipathd
 * OS::TripleO::Services::MySQLClient
 * OS::TripleO::Services::NeutronBgpVpnBagpipe
 * OS::TripleO::Services::NeutronLinuxbridgeAgent
 * OS::TripleO::Services::NeutronVppAgent
 * OS::TripleO::Services::NovaAZConfig
 * OS::TripleO::Services::NovaCompute
 * OS::TripleO::Services::NovaLibvirt
 * OS::TripleO::Services::NovaLibvirtGuests
 * OS::TripleO::Services::NovaMigrationTarget
 * OS::TripleO::Services::ContainersLogrotateCrond
 * OS::TripleO::Services::PacemakerRemote
 * OS::TripleO::Services::Podman
 * OS::TripleO::Services::Rhsm
 * OS::TripleO::Services::Rsyslog
 * OS::TripleO::Services::RsyslogSidecar
 * OS::TripleO::Services::Securetty
 * OS::TripleO::Services::Snmp
 * OS::TripleO::Services::Sshd
 * OS::TripleO::Services::Timesync
 * OS::TripleO::Services::Timezone
 * OS::TripleO::Services::TripleoFirewall
 * OS::TripleO::Services::TripleoPackages
 * OS::TripleO::Services::Tuned
 * OS::TripleO::Services::Vpp
 * OS::TripleO::Services::OVNController
 * OS::TripleO::Services::OVNMetadataAgent
description: 'Compute Instance HA Node role to be used with -e environments/compute-instanceha.yaml
'
name: 'ComputeInstanceHA'
networks: '{'InternalApi': {'subnet': 'internal_api_subnet'}, 'Tenant': {'subnet': 'tenant_subnet'}, 'Storage': {'subnet': 'storage_subnet'}}'
update_serial: '25'</pre></div></div></li><li><p>Create a <code>~/templates-custom</code> directory</p><div class="listingblock"><div class="content"><pre class="nowrap">(undercloud) [stack@undercloud ~]$ mkdir -p ~/templates-custom/templates/</pre></div></div></li><li><p>Generate a custom <code>~/templates-custom/roles_data.yaml</code> file with roles required for this exercise:</p><div class="listingblock"><div class="title">[undercloud]</div><div class="content"><pre class="nowrap">(undercloud) [stack@undercloud ~]$ openstack overcloud roles generate -o ~/templates-custom/roles_data.yaml Controller ComputeInstanceHA Networker ObjectStorage</pre></div></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="icon-note" title="Note"></i></td><td class="content">After further edits, you will include the custom <code>roles_data.yaml</code> file into the deployment plan with the <code>--roles-file</code> (or <code>-r</code>) option.</td></tr></table></div></li></ol></div></div></div>
<div class="sect1"><h2 id="_customize_roles_and_network_data_files">3. Customize Roles and Network Data Files</h2><div class="sectionbody"><div class="paragraph"><p>In this exercise, you are going to utilize the <code>Networker</code> and <code>ObjectStorage</code> roles on dedicated nodes and remove Neutron agents and SwiftStorage services from the <code>Controller</code> role. In addition, you are going to define a new network (called in the lab environment as <code>provider</code> network) and specify that it is attached to the networker and compute nodes. The <code>provider</code> network is physically different than the <code>trunk</code> network you used before. The <code>trunk</code> network is attached to all nodes via <code>nic2</code> and <code>nic3</code> intefaces; the <code>provider</code> network is attached via <code>nic4</code> (<code>eth3</code>) interface.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Create a copy of the network data file from previous lab:</p><div class="listingblock"><div class="title">[undercloud]</div><div class="content"><pre class="nowrap">(undercloud) [stack@undercloud ~]$ cp ~/templates/network_data.yaml ~/templates-custom/</pre></div></div></li><li><p>Add parameters of a new <code>provider</code> network into the <code>~/templates-custom/network_data.yaml</code> file:</p><div class="listingblock"><div class="content"><pre class="nowrap">- name: ProviderNetwork
  vip: false
  name_lower: provider_network
  vlan: 70
  ip_subnet: '192.168.3.0/24'
  allocation_pools: [{'start': '192.168.3.4', 'end': '192.168.3.250'}]
  gateway_ip: '192.168.3.1'</pre></div></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="icon-note" title="Note"></i></td><td class="content">You can use any unique network names. They are used by TripleO to generate required Heat templates and resources.</td></tr></table></div>
<div class="admonitionblock important"><table><tr><td class="icon"><i class="icon-important" title="Important"></i></td><td class="content">Specify the <code>vlan</code> parameter even if the network is flat. It is required for compatibility with other TripleO templates. You will have to customize the NIC configuration templates later to match the physical connectivity of your nodes.</td></tr></table></div></li><li><p>Check the <code>Networker</code> role in the custom <code>~/templates-custom/roles_data.yaml</code> file:</p><div class="listingblock"><div class="content"><pre class="nowrap">###############################################################################
# Role: Networker                                                             #
###############################################################################
- name: Networker
  description: |
    Standalone networking role to run Neutron agents on their own.
  networks:
    InternalApi:
      subnet: internal_api_subnet
    Tenant:
      subnet: tenant_subnet
  tags:
    - external_bridge
  HostnameFormatDefault: '%stackname%-networker-%index%'
  update_serial: 1
  ServicesDefault:
    - OS::TripleO::Services::Aide
    - OS::TripleO::Services::AuditD
    - OS::TripleO::Services::BootParams
    - OS::TripleO::Services::CACerts
    - OS::TripleO::Services::CertmongerUser
    - OS::TripleO::Services::Collectd
    - OS::TripleO::Services::podman
    - OS::TripleO::Services::IpaClient
    - OS::TripleO::Services::Ipsec
    - OS::TripleO::Services::IronicNeutronAgent
    - OS::TripleO::Services::Kernel
    - OS::TripleO::Services::LoginDefs
    - OS::TripleO::Services::MetricsQdr
    - OS::TripleO::Services::MySQLClient
    - OS::TripleO::Services::NeutronDhcpAgent
    - OS::TripleO::Services::NeutronL2gwAgent
    - OS::TripleO::Services::NeutronL3Agent
    - OS::TripleO::Services::NeutronMetadataAgent
    - OS::TripleO::Services::NeutronML2FujitsuCfab
    - OS::TripleO::Services::NeutronML2FujitsuFossw
    - OS::TripleO::Services::NeutronOvsAgent
    - OS::TripleO::Services::NeutronVppAgent
    - OS::TripleO::Services::ContainersLogrotateCrond
    - OS::TripleO::Services::OctaviaDeploymentConfig
    - OS::TripleO::Services::OctaviaHealthManager
    - OS::TripleO::Services::OctaviaHousekeeping
    - OS::TripleO::Services::OctaviaWorker
    - OS::TripleO::Services::OVNController
    - OS::TripleO::Services::Podman
    - OS::TripleO::Services::Rhsm
    - OS::TripleO::Services::Rsyslog
    - OS::TripleO::Services::Snmp
    - OS::TripleO::Services::Sshd
    - OS::TripleO::Services::Timesync
    - OS::TripleO::Services::Timezone
    - OS::TripleO::Services::TripleoFirewall
    - OS::TripleO::Services::TripleoPackages
    - OS::TripleO::Services::Tuned</pre></div></div></li><li><p>Add lines to the <code>networks</code> section specifying connectivity  <code>ProviderNetwork</code> networks:</p><div class="listingblock"><div class="content"><pre class="nowrap">  networks:
    InternalApi:
      subnet: internal_api_subnet
    Tenant:
      subnet: tenant_subnet
    ProviderNetwork:
      subnet: provider_network_subnet</pre></div></div>
<div class="paragraph"><p>The <code>ProviderNetwork</code> is the network you added to the custom network data file. The <code>External</code> network was already there.</p></div></li><li><p>Add the <code>ProviderNetwork</code> line into the <code>networks</code> section of the <code>ComputeInstanceHA</code> role:</p><div class="listingblock"><div class="content"><pre class="nowrap">  networks:
    InternalApi:
      subnet: internal_api_subnet
    Tenant:
      subnet: tenant_subnet
    Storage:
      subnet: storage_subnet
    ProviderNetwork:
      subnet: provider_network_subnet</pre></div></div></li><li><p>Remove the <code>Tenant</code> network from the <code>networks</code> section of the <code>Controller</code> role:</p><div class="listingblock"><div class="content"><pre class="nowrap">    Tenant:                 # Delete line
      subnet: tenant_subnet # Delete line</pre></div></div></li><li><p>Remove the <code>SwiftStorage</code> service from the <code>Controller</code> role:</p><div class="listingblock"><div class="content"><pre class="nowrap">- name: Controller
  CountDefault: 1
  ServicesDefault:
    (...)
    - OS::TripleO::Services::SwiftProxy
    - OS::TripleO::Services::SwiftDispersion
    - OS::TripleO::Services::SwiftRingBuilder
    - OS::TripleO::Services::SwiftStorage            # Delete line</pre></div></div>
<div class="paragraph"><p>In this lab, you will use a dedicated node with an extra disk for Swift storage. This customization excludes the Controller from the Swift cluster.</p></div></li></ol></div></div></div>
<div class="sect1"><h2 id="_render_tripleo_templates">4. Render TripleO Templates</h2><div class="sectionbody"><div class="paragraph"><p>The roles and network data files are ready. Now you can use them to render TripleO templates to generate few files required for futher customization.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Create a temporary directory used to output rendered TripleO templates and generated files:</p><div class="listingblock"><div class="title">[undercloud]</div><div class="content"><pre class="nowrap">(undercloud) [stack@undercloud ~]$ mkdir ~/rendered-custom</pre></div></div></li><li><p>Generate rendered TripleO templates:</p><div class="listingblock"><div class="title">[undercloud]</div><div class="content"><pre class="nowrap">(undercloud) [stack@undercloud ~]$ cd /usr/share/openstack-tripleo-heat-templates
(undercloud) [stack@undercloud openstack-tripleo-heat-templates]$ tools/process-templates.py -r ~/templates-custom/roles_data.yaml -n ~/templates-custom/network_data.yaml -o ~/rendered-custom
(undercloud) [stack@undercloud openstack-tripleo-heat-templates]$ cd ~</pre></div></div></li></ol></div></div></div>
<div class="sect1"><h2 id="_customize_network_configuration_templates_for_selected_roles">5. Customize Network Configuration Templates for Selected Roles</h2><div class="sectionbody"><div class="paragraph"><p>TripleO generates sample resource registry files and NIC configuration templates for roles used in the deployment plan. You can select the most appropriate variant of the network connectivity and perform further customizations of the NIC configuration templates.</p></div>
<div class="sect2"><h3 id="_select_appropriate_resource_registry_file">5.1. Select Appropriate Resource Registry File</h3><div class="olist arabic"><ol class="arabic"><li><p>Copy the rendered network configuration files to your <code>~/templates-custom</code> directory:</p><div class="listingblock"><div class="title">[undercloud]</div><div class="content"><pre class="nowrap">(undercloud) [stack@undercloud ~]$ cp -rp ~/rendered-custom/network ~/templates-custom/</pre></div></div></li><li><p>Copy one of the generated resource registry files suitable to the type of networking used in your overcloud nodes. In the lab environment, you should use the following file:</p><div class="listingblock"><div class="title">[undercloud]</div><div class="content"><pre class="nowrap">(undercloud) [stack@undercloud ~]$ mkdir -p ~/templates-custom/environments
(undercloud) [stack@undercloud ~]$ cp ~/rendered-custom/environments/net-bond-with-vlans.yaml ~/templates-custom/environments</pre></div></div></li><li><p>Review the content of this file:</p><div class="listingblock"><div class="title">[undercloud]</div><div class="content"><pre class="nowrap">(undercloud) [stack@undercloud ~]$ cat ~/templates-custom/environments/net-bond-with-vlans.yaml</pre></div></div>
<div class="listingblock"><div class="title">Expected Output</div><div class="content"><pre class="nowrap"># This template configures each role to use a pair of bonded nics (nic2 and
# nic3) and configures an IP address on each relevant isolated network
# for each role. This template assumes use of network-isolation.yaml.
#
# FIXME: if/when we add functionality to heatclient to include heat
# environment files we should think about using it here to automatically
# include network-isolation.yaml.
#
# There is no longer a requirement to use net-bond-with-vlans-v6.yaml for
# nodes when deploying with IPv6. You may now define both an IPv4 network
# and an IPv6 network as default routes by adding both networks to the
# default_route_networks list for the Controller role in roles_data.yaml.
# Then include this environment file to use bond-with-vlans NIC configs.

resource_registry:
  # Network configuration assignments for the Controller
  OS::TripleO::Controller::Net::SoftwareConfig: ../network/config/bond-with-vlans/controller.yaml
  # Network configuration assignments for the ComputeInstanceHA
  OS::TripleO::ComputeInstanceHA::Net::SoftwareConfig: ../network/config/bond-with-vlans/computeinstanceha.yaml
  # Network configuration assignments for the Networker
  OS::TripleO::Networker::Net::SoftwareConfig: ../network/config/bond-with-vlans/networker.yaml
  # Network configuration assignments for the ObjectStorage
  OS::TripleO::ObjectStorage::Net::SoftwareConfig: ../network/config/bond-with-vlans/swift-storage.yaml</pre></div></div>
<div class="paragraph"><p>The resource registry defines Heat resource types for all roles used in the deployment plan and points to the location of the NIC configuration templates that you need to customize further.</p></div>
<div class="admonitionblock important"><table><tr><td class="icon"><i class="icon-important" title="Important"></i></td><td class="content">Do not reuse old NIC configuration files if you changed network definitions in the roles or network data files. TripleO workflows will generate new templates and environment files during the deployment and the old NIC configuration templates may be incompatible with the new set of parameters passed from the top level overcloud Heat stack.</td></tr></table></div></li></ol></div></div>
<div class="sect2"><h3 id="_customize_nic_configuration_templates">5.2. Customize NIC Configuration Templates</h3><div class="paragraph"><p>In the lab environment, the <code>ProviderNetwork</code> network is implemented as a flat network attached to all nodes via <code>br-ex</code>. However, the TripleO generates NIC configuration templates with network separation using VLANs. Moreover, it is connected to nodes via the <code>nic4</code> interface. To integrate this network with OVS on compute and networker nodes you need to define a new bridge (e.g. <code>br-provider</code>). Patches defined below allow you to make modifications in the corresponding NIC configurations templates.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Configure <code>~/templates-custom/network/config/bond-with-vlans/computeinstanceha.yaml</code> to create <code>br-provider</code> as flat network</p><div class="olist loweralpha"><ol class="loweralpha" type="a"><li><p>Remove following lines</p><div class="listingblock"><div class="content"><pre class="nowrap">                - type: vlan
                  mtu:
                    get_param: ProviderNetworkMtu
                  vlan_id:
                    get_param: ProviderNetworkNetworkVlanID
                  addresses:
                  - ip_netmask:
                      get_param: ProviderNetworkIpSubnet
                  routes:
                    list_concat_unique:
                      - get_param: ProviderNetworkInterfaceRoutes</pre></div></div></li><li><p>Add following lines before <code>outputs:</code></p><div class="listingblock"><div class="content"><pre class="nowrap">              - type: ovs_bridge
                name: br-provider
                use_dhcp: false
                addresses:
                - ip_netmask:
                    get_param: ProviderNetworkIpSubnet
                members:
                - type: interface
                  name: nic4</pre></div></div></li></ol></div></li><li><p>Configure <code>~/templates-custom/network/config/bond-with-vlans/networker.yaml</code> to create <code>br-provider</code> as flat network</p><div class="olist loweralpha"><ol class="loweralpha" type="a"><li><p>Remove following lines</p><div class="listingblock"><div class="content"><pre class="nowrap">                - type: vlan
                  mtu:
                    get_param: ProviderNetworkMtu
                  vlan_id:
                    get_param: ProviderNetworkNetworkVlanID
                  addresses:
                  - ip_netmask:
                      get_param: ProviderNetworkIpSubnet
                  routes:
                    list_concat_unique:
                      - get_param: ProviderNetworkInterfaceRoutes</pre></div></div></li><li><p>Add following lines before <code>outputs:</code></p><div class="listingblock"><div class="content"><pre class="nowrap">              - type: ovs_bridge
                name: br-provider
                use_dhcp: false
                addresses:
                - ip_netmask:
                    get_param: ProviderNetworkIpSubnet
                members:
                - type: interface
                  name: nic4</pre></div></div></li></ol></div></li></ol></div></div>
<div class="sect2"><h3 id="_customize_network_environment_template">5.3. Customize Network Environment Template</h3><div class="paragraph"><p>The local network environment parameters need to be specified in a custom network environment file (e.g., in <code>~/templates-custom/environments/network-environment.yaml</code>). Because you added a new OVS bridge (<code>br-provider</code>) to the NIC configuration files, you need to customize Neutron parameters to use it.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Copy <code>network-environment.yaml</code> file from rendered</p><div class="listingblock"><div class="content"><pre class="nowrap">(undercloud) [stack@undercloud ~]$ cp ~/rendered-custom/environments/network-environment.yaml ~/templates-custom/environments/</pre></div></div></li><li><p>Add the following lines to the <code>~/templates-custom/environments/network-environment.yaml</code> file:</p><div class="listingblock"><div class="content"><pre class="nowrap">  NeutronBridgeMappings: datacentre:br-ex,provider:br-provider
  NeutronFlatNetworks: datacentre,provider
  NeutronEnableDVR: false</pre></div></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="icon-note" title="Note"></i></td><td class="content">We will disable DVR to use Networker nodes as centralized node.</td></tr></table></div></li></ol></div></div></div></div>
<div class="sect1"><h2 id="_define_node_counts_and_flavors">6. Define Node Counts and Flavors</h2><div class="sectionbody"><div class="paragraph"><p>You need to specify how many nodes should be deployed in your overcloud for the corresponding roles. If you use director for bare metal provisioning then Nova scheduler selects nodes based on the assigned profiles or using scheduler hooks.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Create the <code>~/templates-custom/node-info.yaml</code> file with the following content:</p><div class="listingblock"><div class="content"><pre class="nowrap">parameter_defaults:
  NetworkDeploymentActions: ['CREATE','UPDATE']

  ControllerCount: 1
  OvercloudControllerFlavor: control

  ComputeInstanceHACount: 2
  OvercloudComputeInstanceHAFlavor: compute-instance-ha

  ObjectStorageCount: 1
  OvercloudObjectStorageFlavor: swift-storage

  NetworkerCount: 1
  OvercloudNetworkerFlavor: networker

  # additional settings

  NovaReservedHostMemory: 1024
  podmanPuppetProcessCount: 1

  SwiftRawDisks: {"vdb": {}}

  # No shared storage for InstanceHA
  ExtraConfig:
    tripleo::instanceha::no_shared_storage: true</pre></div></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="icon-note" title="Note"></i></td><td class="content"><div class="paragraph"><p>The file uses flavors that can be used by Nova scheduler to assign bare metal nodes to roles. These flavors needs to be defined in the undercloud and tagged to the corresponding profiles.</p></div>
<div class="paragraph"><p>Disks for the Swift storage are specified by the <code>SwiftRawDisks</code> parameter. In the lab environment, you use the second disk of the storage node (<code>/dev/vdb</code>).</p></div></td></tr></table></div></li></ol></div></div></div>
<div class="sect1"><h2 id="_create_flavors_in_undercloud">7. Create Flavors in Undercloud</h2><div class="sectionbody"><div class="paragraph"><p>In order for Red Hat OpenStack Platform director to pick a bare metal node for a role, you need to define corresponding flavors in your undercloud and associate them to profiles.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>List flavors defined in the undercloud:</p><div class="listingblock"><div class="title">[undercloud]</div><div class="content"><pre class="nowrap">(undercloud) [stack@undercloud ~]$ openstack flavor list</pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="nowrap">+--------------------------------------+---------------+------+------+-----------+-------+-----------+
| ID                                   | Name          |  RAM | Disk | Ephemeral | VCPUs | Is Public |
+--------------------------------------+---------------+------+------+-----------+-------+-----------+
| 49c72f8e-a811-449e-9bb4-b7dc7d629ade | control       | 4096 |   40 |         0 |     1 | True      |
| 54e5ccc1-14d3-4ec6-b0a4-2ad436cf3b87 | compute       | 4096 |   40 |         0 |     1 | True      |
| 81bec8ee-8c6f-4208-9d0a-a9913cd4d880 | block-storage | 4096 |   40 |         0 |     1 | True      |
| a5411a3d-a77b-4944-8290-64dc2dce8245 | ceph-storage  | 4096 |   40 |         0 |     1 | True      |
| a5d11f62-a02d-42da-abf3-54cecc653432 | baremetal     | 4096 |   40 |         0 |     1 | True      |
| c0bec4cf-5df8-4241-a7f2-b39e127a833b | swift-storage | 4096 |   40 |         0 |     1 | True      |
+--------------------------------------+---------------+------+------+-----------+-------+-----------+</pre></div></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="icon-note" title="Note"></i></td><td class="content">The <code>baremetal</code> flavor is used by default for all roles. Usually you override this default in a custom environment file using parameters like <code>OvercloudControllerFlavor</code>, <code>OvercloudComputeFlavor</code>, etc.</td></tr></table></div></li><li><p>Define any custom flavors required for your overcloud deployment. For example, create the <code>networker</code> flavor:</p><div class="listingblock"><div class="title">[undercloud]</div><div class="content"><pre class="nowrap">(undercloud) [stack@undercloud ~]$ openstack flavor create --id auto --ram 4096 --disk 40 --vcpus 1 networker
(undercloud) [stack@undercloud ~]$ openstack flavor set --property "cpu_arch"="x86_64" --property "capabilities:boot_option"="local" --property "capabilities:profile"="networker" networker
(undercloud) [stack@undercloud ~]$ openstack flavor set --property resources:VCPU=0 --property resources:MEMORY_MB=0 --property resources:DISK_GB=0 --property resources:CUSTOM_BAREMETAL=1 networker
(undercloud) [stack@undercloud ~]$ openstack flavor create --id auto --ram 4096 --disk 40 --vcpus 1 compute-instance-ha
(undercloud) [stack@undercloud ~]$ openstack flavor set --property "cpu_arch"="x86_64" --property "capabilities:boot_option"="local" --property "capabilities:profile"="compute-instance-ha" compute-instance-ha
(undercloud) [stack@undercloud ~]$ openstack flavor set --property resources:VCPU=0 --property resources:MEMORY_MB=0 --property resources:DISK_GB=0 --property resources:CUSTOM_BAREMETAL=1 compute-instance-ha</pre></div></div></li></ol></div></div></div>
<div class="sect1"><h2 id="_assign_profiles_to_bare_metal_nodes">8. Assign Profiles to Bare Metal Nodes</h2><div class="sectionbody"><div class="olist arabic"><ol class="arabic"><li><p>Review what profiles are assigned to the bare metal nodes:</p><div class="listingblock"><div class="title">[undercloud]</div><div class="content"><pre class="nowrap">(undercloud) [stack@undercloud ~]$ openstack overcloud profiles list</pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="nowrap">+--------------------------------------+---------------------+-----------------+-----------------+-------------------+
| Node UUID                            | Node Name           | Provision State | Current Profile | Possible Profiles |
+--------------------------------------+---------------------+-----------------+-----------------+-------------------+
| ac2ad1da-b707-4f8a-bf6a-f0b085d3ec61 | overcloud-compute01 | available       | None            |                   |
| 480eb209-73b1-41d5-9ece-637e732e32ca | overcloud-compute02 | available       | None            |                   |
| a7460dc8-3526-4d2c-b508-84e4daea86c3 | overcloud-ctrl01    | available       | None            |                   |
| 3f38f040-b0d1-4a33-9358-a791334d6953 | overcloud-ctrl02    | available       | None            |                   |
| 95434ab1-4b75-45ec-9969-53f8c49128cc | overcloud-ctrl03    | available       | None            |                   |
| dd41a2ae-d704-484c-bb0f-aa0744c394de | overcloud-networker | available       | None            |                   |
| 68aaee46-bebd-4a76-8196-bcf118903abb | overcloud-stor01    | available       | None            |                   |
+--------------------------------------+---------------------+-----------------+-----------------+-------------------+</pre></div></div></li><li><p>Assign profiles required for your overcloud deployment:</p><div class="listingblock"><div class="title">[undercloud]</div><div class="content"><pre class="nowrap">(undercloud) [stack@undercloud ~]$ openstack baremetal node set overcloud-ctrl01 --property capabilities=profile:control,boot_option:local
(undercloud) [stack@undercloud ~]$ openstack baremetal node set overcloud-compute01 --property capabilities=profile:compute-instance-ha,boot_option:local
(undercloud) [stack@undercloud ~]$ openstack baremetal node set overcloud-compute02 --property capabilities=profile:compute-instance-ha,boot_option:local
(undercloud) [stack@undercloud ~]$ openstack baremetal node set overcloud-stor01 --property capabilities=profile:swift-storage,boot_option:local
(undercloud) [stack@undercloud ~]$ openstack baremetal node set overcloud-networker --property capabilities=profile:networker,boot_option:local</pre></div></div></li><li><p>Review the overcloud profiles again:</p><div class="listingblock"><div class="title">[undercloud]</div><div class="content"><pre class="nowrap">(undercloud) [stack@undercloud ~]$ openstack overcloud profiles list</pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="nowrap">+--------------------------------------+---------------------+-----------------+-----------------+-------------------+
| Node UUID                            | Node Name           | Provision State | Current Profile | Possible Profiles |
+--------------------------------------+---------------------+-----------------+-----------------+-------------------+
| ac2ad1da-b707-4f8a-bf6a-f0b085d3ec61 | overcloud-compute01 | available       | compute         |                   |
| 480eb209-73b1-41d5-9ece-637e732e32ca | overcloud-compute02 | available       | compute         |                   |
| a7460dc8-3526-4d2c-b508-84e4daea86c3 | overcloud-ctrl01    | available       | control         |                   |
| 3f38f040-b0d1-4a33-9358-a791334d6953 | overcloud-ctrl02    | available       | None            |                   |
| 95434ab1-4b75-45ec-9969-53f8c49128cc | overcloud-ctrl03    | available       | None            |                   |
| dd41a2ae-d704-484c-bb0f-aa0744c394de | overcloud-networker | available       | networker       |                   |
| 68aaee46-bebd-4a76-8196-bcf118903abb | overcloud-stor01    | available       | swift-storage   |                   |
+--------------------------------------+---------------------+-----------------+-----------------+-------------------+</pre></div></div></li></ol></div></div></div>
<div class="sect1"><h2 id="_configure_fencing">9. Configure fencing</h2><div class="sectionbody"><div class="paragraph"><p>To use <code>ComputeInstanceHA</code> we need to configure the fencing.
. Generate <code>~/templates/fencing.yaml</code></p></div>
<div class="listingblock"><div class="title">[undercloud]</div><div class="content"><pre class="nowrap">(undercloud) [stack@undercloud ~]$ openstack overcloud generate fencing --ipmi-lanplus --ipmi-level administrator --output ~/templates-custom/fencing.yaml ~/nodes.json</pre></div></div></div></div>
<div class="sect1"><h2 id="_deploying_the_overcloud">10. Deploying the Overcloud</h2><div class="sectionbody"><div class="olist arabic"><ol class="arabic"><li><p>Create a new deploy script named <code>~/deploy-custom.sh</code>:</p><div class="listingblock"><div class="content"><pre class="nowrap">#!/bin/bash
THT=/usr/share/openstack-tripleo-heat-templates/
CNF=~/templates-custom/

source ~/stackrc
openstack overcloud deploy --templates $THT \
-r $CNF/roles_data.yaml \
-n $CNF/network_data.yaml \
-e $THT/environments/network-isolation.yaml \
-e $THT/environments/disable-telemetry.yaml \
-e $THT/environments/compute-instanceha.yaml \
-e $CNF/environments/network-environment.yaml \
-e $CNF/environments/net-bond-with-vlans.yaml \
-e ~/containers-prepare-parameter.yaml \
-e $CNF/node-info.yaml \
-e $CNF/fencing.yaml</pre></div></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="icon-note" title="Note"></i></td><td class="content">The Telemetry services are disable to save limited resources available in the lab environment.</td></tr></table></div></li><li><p>Execute the deployment script.</p></li></ol></div></div></div>
<div class="sect1"><h2 id="_review_the_deployed_overcloud">11. Review the Deployed Overcloud</h2><div class="sectionbody"><div class="olist arabic"><ol class="arabic"><li><p>List the deployed nodes:</p><div class="listingblock"><div class="title">[undercloud]</div><div class="content"><pre class="nowrap">(undercloud) [stack@undercloud ~]$ openstack server list</pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="nowrap">+--------------------------------------+----------------------------+--------+---------------------+----------------+---------------------+
| ID                                   | Name                       | Status | Networks            | Image          | Flavor              |
+--------------------------------------+----------------------------+--------+---------------------+----------------+---------------------+
| 1d5b5e68-a334-4912-af79-2f70d06865ca | overcloud-controller-0     | ACTIVE | ctlplane=192.0.2.14 | overcloud-full | control             |
| aacf3bc4-5428-4691-a287-898484f99ad7 | overcloud-novacomputeiha-0 | ACTIVE | ctlplane=192.0.2.21 | overcloud-full | compute-instance-ha |
| d216dc23-1a99-4235-b935-20f25402eecf | overcloud-novacomputeiha-1 | ACTIVE | ctlplane=192.0.2.19 | overcloud-full | compute-instance-ha |
| 8c051558-06a6-46d9-9daa-caa3eee7ff61 | overcloud-objectstorage-0  | ACTIVE | ctlplane=192.0.2.20 | overcloud-full | swift-storage       |
| 84d68721-9957-463c-956a-632b21e7e545 | overcloud-networker-0      | ACTIVE | ctlplane=192.0.2.24 | overcloud-full | networker           |
+--------------------------------------+----------------------------+--------+---------------------+----------------+---------------------+</pre></div></div></li><li><p>Review the state of the bare metal nodes:</p><div class="listingblock"><div class="title">[undercloud]</div><div class="content"><pre class="nowrap">(undercloud) [stack@undercloud ~]$ openstack baremetal node list</pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="nowrap">+--------------------------------------+---------------------+--------------------------------------+-------------+--------------------+-------------+
| UUID                                 | Name                | Instance UUID                        | Power State | Provisioning State | Maintenance |
+--------------------------------------+---------------------+--------------------------------------+-------------+--------------------+-------------+
| ac2ad1da-b707-4f8a-bf6a-f0b085d3ec61 | overcloud-compute01 | d3a4f872-b7bf-4fa8-ac94-8eca40b09839 | power on    | active             | False       |
| 480eb209-73b1-41d5-9ece-637e732e32ca | overcloud-compute02 | 323a022e-e65f-4285-a823-d1d0cc7950da | power on    | active             | False       |
| a7460dc8-3526-4d2c-b508-84e4daea86c3 | overcloud-ctrl01    | 3abc78fd-09b8-4498-abc3-fb6f9f7b8f66 | power on    | active             | False       |
| 3f38f040-b0d1-4a33-9358-a791334d6953 | overcloud-ctrl02    | None                                 | power off   | available          | False       |
| 95434ab1-4b75-45ec-9969-53f8c49128cc | overcloud-ctrl03    | None                                 | power off   | available          | False       |
| dd41a2ae-d704-484c-bb0f-aa0744c394de | overcloud-networker | 1d628cd9-5876-402b-87c8-d2d68e660c3e | power on    | active             | False       |
| 68aaee46-bebd-4a76-8196-bcf118903abb | overcloud-stor01    | be061659-410c-4e5e-809f-58b843ef017a | power on    | active             | False       |
+--------------------------------------+---------------------+--------------------------------------+-------------+--------------------+-------------+</pre></div></div>
<div class="paragraph"><p>The <code>overcloud-networker</code> node has been chosen during the deployment as well as one controller, two compute, and one swift-storage node.</p></div></li></ol></div>
<div class="sect2"><h3 id="_student_tasks">11.1. Student tasks</h3><div class="olist arabic"><ol class="arabic"><li><p>Using the Validation lab create the public network, public subnet, a router, connect the router to the public network</p></li><li><p>List the ports of the Router</p></li><li><p>Get information of the port and ensure is on the Networker node.</p></li><li><p>Upload cirros image</p></li></ol></div></div>
<div class="sect2"><h3 id="_provider_network">11.2. Provider network</h3><div class="paragraph"><p>In this lab, a new Neutron network will be created utilizing the provider network configured in the <code>network_config.yaml</code> and a new VM will be created to be attached to the provider network.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Create the provider network</p><div class="listingblock"><div class="title">[undercloud]</div><div class="content"><pre class="nowrap">(overcloud) [stack@undercloud ~]$ openstack network create --provider-network-type flat --provider-physical-network provider provnetwork</pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="nowrap">+---------------------------+--------------------------------------+
| Field                     | Value                                |
+---------------------------+--------------------------------------+
| admin_state_up            | UP                                   |
| availability_zone_hints   |                                      |
| availability_zones        |                                      |
| created_at                | 2019-02-08T17:38:27Z                 |
| description               |                                      |
| dns_domain                | None                                 |
| id                        | bed23c4c-daa2-4d7d-9667-816989a95ca3 |
| ipv4_address_scope        | None                                 |
| ipv6_address_scope        | None                                 |
| is_default                | False                                |
| is_vlan_transparent       | None                                 |
| mtu                       | 1500                                 |
| name                      | provnetwork                          |
| port_security_enabled     | True                                 |
| project_id                | e5eacc8d392f46d3b3c111c26c3c560a     |
| provider:network_type     | flat                                 |
| provider:physical_network | provider                             |
| provider:segmentation_id  | None                                 |
| qos_policy_id             | None                                 |
| revision_number           | 3                                    |
| router:external           | Internal                             |
| segments                  | None                                 |
| shared                    | False                                |
| status                    | ACTIVE                               |
| subnets                   |                                      |
| tags                      |                                      |
| updated_at                | 2019-02-08T17:38:28Z                 |
+---------------------------+--------------------------------------+</pre></div></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="icon-note" title="Note"></i></td><td class="content">Notice the <code>physical_network</code> is the name we defined on the parameter <code>NeutronBridgeMappings</code>.</td></tr></table></div></li><li><p>Create the subnet for the provider network.</p><div class="listingblock"><div class="title">[undercloud]</div><div class="content"><pre class="nowrap">(overcloud) [stack@undercloud ~]$ openstack subnet create  --gateway 192.168.3.1  --allocation-pool start=192.168.3.151,end=192.168.3.200  --network provnetwork --subnet-range 192.168.3.0/24 provsubnet</pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="nowrap">+-------------------+--------------------------------------+
| Field             | Value                                |
+-------------------+--------------------------------------+
| allocation_pools  | 192.168.3.151-192.168.3.200          |
| cidr              | 192.168.3.0/24                       |
| created_at        | 2019-02-08T17:38:38Z                 |
| description       |                                      |
| dns_nameservers   |                                      |
| enable_dhcp       | True                                 |
| gateway_ip        | 192.168.3.1                          |
| host_routes       |                                      |
| id                | ee737f2f-813c-49ca-8dc2-17752fad9d19 |
| ip_version        | 4                                    |
| ipv6_address_mode | None                                 |
| ipv6_ra_mode      | None                                 |
| name              | provsubnet                           |
| network_id        | bed23c4c-daa2-4d7d-9667-816989a95ca3 |
| project_id        | e5eacc8d392f46d3b3c111c26c3c560a     |
| revision_number   | 0                                    |
| segment_id        | None                                 |
| service_types     |                                      |
| subnetpool_id     | None                                 |
| tags              |                                      |
| updated_at        | 2019-02-08T17:38:38Z                 |
+-------------------+--------------------------------------+</pre></div></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="icon-note" title="Note"></i></td><td class="content">The IP <code>192.168.3.1</code> is configured on the hypervisor for the network in libvirt named <code>provider</code>.</td></tr></table></div></li><li><p>Create a new server using the previous security group and the provider network.</p><div class="listingblock"><div class="title">[undercloud]</div><div class="content"><pre class="nowrap">(overcloud) [stack@undercloud ~]$ openstack server create --flavor m1.tiny --image cirros --key-name stack --security-group $sg_id --nic net-id=provnetwork vmprov --config-drive true</pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="nowrap">+-------------------------------------+------------------------------------------------+
| Field                               | Value                                          |
+-------------------------------------+------------------------------------------------+
| OS-DCF:diskConfig                   | MANUAL                                         |
| OS-EXT-AZ:availability_zone         |                                                |
| OS-EXT-SRV-ATTR:host                | None                                           |
| OS-EXT-SRV-ATTR:hypervisor_hostname | None                                           |
| OS-EXT-SRV-ATTR:instance_name       |                                                |
| OS-EXT-STS:power_state              | NOSTATE                                        |
| OS-EXT-STS:task_state               | scheduling                                     |
| OS-EXT-STS:vm_state                 | building                                       |
| OS-SRV-USG:launched_at              | None                                           |
| OS-SRV-USG:terminated_at            | None                                           |
| accessIPv4                          |                                                |
| accessIPv6                          |                                                |
| addresses                           |                                                |
| adminPass                           | 3YPbCi43LDid                                   |
| config_drive                        | True                                           |
| created                             | 2019-02-08T17:47:56Z                           |
| flavor                              | m1.tiny (d2e8f314-5ecf-4016-a4d4-6ccb8f11ec8e) |
| hostId                              |                                                |
| id                                  | e6e80cb6-4043-4ed0-8cad-cc4b346dfec4           |
| image                               | cirros (568eeff2-c04d-4ecc-bf2d-f93ae5c38546)  |
| key_name                            | stack                                          |
| name                                | vmprov                                         |
| progress                            | 0                                              |
| project_id                          | e5eacc8d392f46d3b3c111c26c3c560a               |
| properties                          |                                                |
| security_groups                     | name='9556d1bb-372d-4983-853f-cda4c3bd98af'    |
| status                              | BUILD                                          |
| updated                             | 2019-02-08T17:47:56Z                           |
| user_id                             | 9e6f655417af447d8d0371547b56f7c7               |
| volumes_attached                    |                                                |
+-------------------------------------+------------------------------------------------+</pre></div></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="icon-note" title="Note"></i></td><td class="content">The option <code>--config-drive true</code> injects the metadata inside the VM. AS is a provider network, the gateway won&#8217;t provide the metadata information.</td></tr></table></div></li><li><p>Obtain the status and the IP address of the instance.</p><div class="listingblock"><div class="title">[undercloud]</div><div class="content"><pre class="nowrap">(overcloud) [stack@undercloud ~]$  openstack server list --name vmprov</pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="nowrap">+--------------------------------------+--------+--------+---------------------------+--------+---------+
| ID                                   | Name   | Status | Networks                  | Image  | Flavor  |
+--------------------------------------+--------+--------+---------------------------+--------+---------+
| e6e80cb6-4043-4ed0-8cad-cc4b346dfec4 | vmprov | ACTIVE | provnetwork=192.168.3.152 | cirros | m1.tiny |
+--------------------------------------+--------+--------+---------------------------+--------+---------+</pre></div></div></li><li><p>Login to the instance:</p><div class="listingblock"><div class="title">[undercloud]</div><div class="content"><pre class="nowrap">(overcloud) [stack@undercloud ~]$ ssh cirros@192.168.3.152
$</pre></div></div>
<div class="paragraph"><p>You can access instances attached to the provider networks without assigning them floating IPs because provider networks in Neutron are mapped to the physical networks in the datacenter.</p></div></li></ol></div></div>
<div class="sect2"><h3 id="_swift_configuration">11.3. Swift Configuration</h3><div class="paragraph"><p>In the <code>~/templates/node-config.yaml</code> file, you defined the <code>/dev/vdb</code> device as a disk for Swift storage.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Get the object storage node&#8217;s IP address:</p><div class="listingblock"><div class="title">[undercloud]</div><div class="content"><pre class="nowrap">(overcloud) [stack@undercloud ~]$ source ~/stackrc
(undercloud) [stack@undercloud ~]$ openstack server list</pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre>+--------------------------------------+----------------------------+--------+----------------------+----------------+---------------------+
| ID                                   | Name                       | Status | Networks             | Image          | Flavor              |
+--------------------------------------+----------------------------+--------+----------------------+----------------+---------------------+
| ecb44d59-73a9-4f0a-b00d-c8196897300f | overcloud-novacomputeiha-1 | ACTIVE | ctlplane=192.0.2.27 | overcloud-full | compute-instance-ha |
| 7f7937ec-1678-4c44-aaf3-7361873bd498 | overcloud-novacomputeiha-0 | ACTIVE | ctlplane=192.0.2.35 | overcloud-full | compute-instance-ha |
| 0fc4aaed-a06a-45b8-a4be-82a955731cdc | overcloud-controller-0     | ACTIVE | ctlplane=192.0.2.25 | overcloud-full | control             |
| b28e11cf-fa81-4553-a482-8d66ea3ccefa | overcloud-objectstorage-0  | ACTIVE | ctlplane=192.0.2.40 | overcloud-full | swift-storage       |
| 65b87ce9-351e-4c69-ba73-b8173466e8ab | overcloud-networker-0      | ACTIVE | ctlplane=192.0.2.39 | overcloud-full | networker           |
+--------------------------------------+----------------------------+--------+----------------------+----------------+---------------------+</pre></div></div></li><li><p>Ensure the <code>/dev/vdb</code> disk is in use:</p><div class="listingblock"><div class="title">[undercloud]</div><div class="content"><pre class="nowrap">(undercloud) [stack@undercloud ~]$ ssh heat-admin@192.0.2.24 "df /dev/vdb"</pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="nowrap">Filesystem     1K-blocks  Used Available Use% Mounted on
/dev/vdb        62883840 33024  62850816   1% /srv/node/vdb</pre></div></div></li><li><p>You removed the <code>SwiftStorage</code> service from the <code>Controller</code> role. Verify that the object storage node alone is in the Swift cluster:</p><div class="listingblock"><div class="title">[undercloud]</div><div class="content"><pre class="nowrap">(undercloud) [stack@undercloud ~]$ ssh -t heat-admin@192.0.2.24 "sudo podman exec -ti  swift_object_server swift-ring-builder /etc/swift/object.builder"</pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="nowrap">/etc/swift/object.builder, build version 2, id 1768ded5f18745b8b9d803badbec753a
1024 partitions, 1.000000 replicas, 1 regions, 1 zones, 1 devices, 0.00 balance, 0.00 dispersion
The minimum number of hours before a partition can be reassigned is 1 (0:00:00 remaining)
The overload factor is 0.00% (0.000000)
Ring file /etc/swift/object.ring.gz is up-to-date
Devices:   id region zone   ip address:port replication ip:port  name weight partitions balance flags meta
            0      1    1 172.17.4.221:6000   172.17.4.221:6000    d1 100.00       1024    0.00</pre></div></div>
<div class="paragraph"><p>The list of devices in the output above includes the IP address of the object storage node only. This IP address is from the <code>StorageMgmt</code> allocation pool.</p></div></li></ol></div></div>
<div class="sect2"><h3 id="_testing_evacuation_with_instance_ha">11.4. Testing Evacuation with Instance HA</h3><div class="paragraph"><p>Student tasks:</p></div>
<div class="ulist"><ul><li><p>List where the vms are running (<code>openstack server list --long</code>)</p></li><li><p>Connect to one of the hypervisors where one VM is running</p></li><li><p>Force the crash of the server (<code>echo c &gt; /proc/sysrq-trigger</code>)</p></li><li><p>Ensure the VM is moved automatically to the another host.</p></li><li><p>Ensure the Host is rebooted automatically (fencing).</p></li></ul></div></div></div></div></div><div id="footer"><div id="footer-text"><br>Build Version: 1.6.7   :   Last updated 2020-09-20 04:59:02 EDT</div></div></body></html>