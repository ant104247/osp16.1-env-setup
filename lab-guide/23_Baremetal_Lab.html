<!DOCTYPE html><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="generator" content="Asciidoctor 0.1.4"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Performance Lab</title><style>@import url(http://cdnjs.cloudflare.com/ajax/libs/font-awesome/3.2.0/css/font-awesome.css);
/*! normalize.css v2.1.2 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }

/** Address `[hidden]` styling not present in IE 8/9. Hide the `template` element in IE, Safari, and Firefox < 22. */
[hidden], template { display: none; }

script { display: none !important; }

/* ========================================================================== Base ========================================================================== */
/** 1. Set default font family to sans-serif. 2. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { font-family: sans-serif; /* 1 */ -ms-text-size-adjust: 100%; /* 2 */ -webkit-text-size-adjust: 100%; /* 2 */ }

/** Remove default margin. */
body { margin: 0; }

/* ========================================================================== Links ========================================================================== */
/** Remove the gray background color from active links in IE 10. */
a { background: transparent; }

/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 2em; margin: 0.67em 0; }

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: bold; }

/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }

/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }

/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }

/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }

/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }

/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sup { top: -0.5em; }

sub { bottom: -0.25em; }

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }

meta.foundation-mq-small { font-family: "only screen and (min-width: 768px)"; width: 768px; }

meta.foundation-mq-medium { font-family: "only screen and (min-width:1280px)"; width: 1280px; }

meta.foundation-mq-large { font-family: "only screen and (min-width:1440px)"; width: 1440px; }

*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }

html, body { font-size: 100%; }

body { background: white; color: #222222; padding: 0; margin: 0; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }

a:hover { cursor: pointer; }

img, object, embed { max-width: 100%; height: auto; }

object, embed { height: 100%; }

img { -ms-interpolation-mode: bicubic; }

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }

.left { float: left !important; }

.right { float: right !important; }

.text-left { text-align: left !important; }

.text-right { text-align: right !important; }

.text-center { text-align: center !important; }

.text-justify { text-align: justify !important; }

.hide { display: none; }

.antialiased, body { -webkit-font-smoothing: antialiased; }

img { display: inline-block; vertical-align: middle; }

textarea { height: auto; min-height: 50px; }

select { width: 100%; }

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }

.subheader, #content #toctitle, .admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .mathblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title, .tableblock > caption { line-height: 1.4; color: #003b6b; font-weight: 300; margin-top: 0.2em; margin-bottom: 0.5em; }

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }

/* Default Link Styles */
a { color: #00579e; text-decoration: none; line-height: inherit; }
a:hover, a:focus { color: #333333; }
a img { border: none; }

/* Default paragraph styles */
p { font-family: Arial, sans-serif; font-weight: normal; font-size: 1em; line-height: 1.6; margin-bottom: 0.75em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: Arial, sans-serif; font-weight: normal; font-style: normal; color: #7b2d00; text-rendering: optimizeLegibility; margin-top: 0.5em; margin-bottom: 0.5em; line-height: 1.2125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #ff6b15; line-height: 0; }

h1 { font-size: 2.125em; }

h2 { font-size: 1.6875em; }

h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }

h4 { font-size: 1.125em; }

h5 { font-size: 1.125em; }

h6 { font-size: 1em; }

hr { border: solid #dddddd; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }

/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }

strong, b { font-weight: bold; line-height: inherit; }

small { font-size: 60%; line-height: inherit; }

code { font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: bold; color: #003426; }

/* Lists */
ul, ol, dl { font-size: 1em; line-height: 1.6; margin-bottom: 0.75em; list-style-position: outside; font-family: Arial, sans-serif; }

ul, ol { margin-left: 1.5em; }
ul.no-bullet, ol.no-bullet { margin-left: 1.5em; }

/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */ }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }

/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }

/* Definition Lists */
dl dt { margin-bottom: 0.3em; font-weight: bold; }
dl dd { margin-bottom: 0.75em; }

/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: black; border-bottom: 1px dotted #dddddd; cursor: help; }

abbr { text-transform: none; }

/* Blockquotes */
blockquote { margin: 0 0 0.75em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: 0.8125em; color: #e15200; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #e15200; }

blockquote, blockquote p { line-height: 1.6; color: #333333; }

/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }

.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }

@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }
/* Print styles.  Inlined to avoid required HTTP connection: www.phpied.com/delay-loading-your-print-css/ Credit to Paul Irish and HTML5 Boilerplate (html5boilerplate.com)
*/
.print-only { display: none !important; }

@media print { * { background: transparent !important; color: #000 !important; /* Black prints faster: h5bp.com/s */ box-shadow: none !important; text-shadow: none !important; }
  a, a:visited { text-decoration: underline; }
  a[href]:after { content: " (" attr(href) ")"; }
  abbr[title]:after { content: " (" attr(title) ")"; }
  .ir a:after, a[href^="javascript:"]:after, a[href^="#"]:after { content: ""; }
  pre, blockquote { border: 1px solid #999; page-break-inside: avoid; }
  thead { display: table-header-group; /* h5bp.com/t */ }
  tr, img { page-break-inside: avoid; }
  img { max-width: 100% !important; }
  @page { margin: 0.5cm; }
  p, h2, h3, #toctitle, .sidebarblock > .content > .title { orphans: 3; widows: 3; }
  h2, h3, #toctitle, .sidebarblock > .content > .title { page-break-after: avoid; }
  .hide-on-print { display: none !important; }
  .print-only { display: block !important; }
  .hide-for-print { display: none !important; }
  .show-for-print { display: inherit !important; } }
/* Tables */
table { background: white; margin-bottom: 1.25em; border: solid 1px #d8d8ce; }
/* Change -webkit-linear-gradient colors to  #a70000 and remove gradient */
table thead, table tfoot { background: -webkit-linear-gradient(top, #a70000, #a70000); font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: white; text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: #6d6e71; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #edf2f2; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.4; }

a:hover, a:focus { text-decoration: underline; }

.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }

*:not(pre) > code { font-size: inherit; padding: 3px 2px 1px 2px; white-space: nowrap; background-color: #eeeeee; border: 1px solid #dddddd; -webkit-border-radius: 0; border-radius: 0; text-shadow: none; }

pre, pre > code { line-height: 1.6; color: black; font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: normal; }

kbd.keyseq { color: #333333; }

kbd:not(.keyseq) { display: inline-block; color: black; font-size: 0.75em; line-height: 1.4; background-color: #F7F7F7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset; margin: -0.15em 0.15em 0 0.15em; padding: 0.2em 0.6em 0.2em 0.5em; vertical-align: middle; white-space: nowrap; }

kbd kbd:first-child { margin-left: 0; }

kbd kbd:last-child { margin-right: 0; }

.menuseq, .menu { color: black; }

b.button:before { content: '[ '; }

b.button:after { content: ' ]'; }

#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 1.5em; padding-right: 1.5em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }

#header { margin-bottom: 2.5em; }
#header > h1 { color: #7b2d00; font-weight: normal; border-bottom: 1px solid #dddddd; margin-bottom: -28px; padding-bottom: 32px; }
#header span { color: #333333; }
#header #revnumber { text-transform: capitalize; }
#header br { display: none; }
#header br + span { padding-left: 3px; }
#header br + span:before { content: "\2013 \0020"; }
#header br + span.author { padding-left: 0; }
#header br + span.author:before { content: ", "; }

#toc { border-bottom: 1px solid #dddddd; padding-bottom: 1.25em; }
#toc > ul { margin-left: 0.25em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
#toc ul { list-style-type: none; }

#toctitle { color: #003b6b; }

@media only screen and (min-width: 768px) { body.toc2 { padding-left: 15em; padding-right: 0; }
  #toc.toc2 { position: fixed; width: 15em; left: 0; top: 0; border-right: 1px solid #dddddd; border-bottom: 0; z-index: 1000; padding: 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; font-size: 1.2em; }
  #toc.toc2 > ul { font-size: .90em; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 15em; }
  body.toc2.toc-right #toc.toc2 { border-right: 0; border-left: 1px solid #dddddd; left: auto; right: 0; } }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; padding-right: 0; }
  #toc.toc2 { width: 20em; }
  #toc.toc2 #toctitle { font-size: 1.375em; }
  #toc.toc2 > ul { font-size: 0.95em; }
  #toc.toc2 ul ul { padding-left: 1.25em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; border-width: 0; -webkit-border-radius: 0; border-radius: 0; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }
#content #toc a { text-decoration: none; }

#content #toctitle { font-weight: bold; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-size: 1em; padding-left: 0.125em; }

#footer { max-width: 100%; background-color: none; padding: 1.25em; }

#footer-text { color: black; line-height: 1.44; }

.sect1 { padding-bottom: 1.25em; }

.sect1 + .sect1 { border-top: 1px solid #dddddd; }

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; width: 1em; margin-left: -1em; display: block; text-decoration: none; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: '\00A7'; font-size: .85em; vertical-align: text-top; display: block; margin-top: 0.05em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #7b2d00; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #622400; }

.imageblock, .literalblock, .listingblock, .mathblock, .verseblock, .videoblock { margin-bottom: 1.25em; }

.admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .mathblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-align: left; font-weight: bold; }

.tableblock > caption { text-align: left; font-weight: bold; white-space: nowrap; overflow: visible; max-width: 0; }

table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }

.admonitionblock > table { border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #dddddd; color: #333333; }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }

.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 0; border-radius: 0; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }
.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6, .exampleblock > .content p { color: #333333; }
.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6 { line-height: 1; margin-bottom: 0.625em; }
.exampleblock > .content h1.subheader, .exampleblock > .content h2.subheader, .exampleblock > .content h3.subheader, .exampleblock > .content .subheader#toctitle, .sidebarblock.exampleblock > .content > .subheader.title, .exampleblock > .content h4.subheader, .exampleblock > .content h5.subheader, .exampleblock > .content h6.subheader { line-height: 1.4; }

.exampleblock.result > .content { -webkit-box-shadow: 0 1px 8px #aaaaaa; box-shadow: 0 1px 8px #aaaaaa; }

.sidebarblock { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 0; border-radius: 0; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6, .sidebarblock p { color: #333333; }
.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6 { line-height: 1; margin-bottom: 0.625em; }
.sidebarblock h1.subheader, .sidebarblock h2.subheader, .sidebarblock h3.subheader, .sidebarblock .subheader#toctitle, .sidebarblock > .content > .subheader.title, .sidebarblock h4.subheader, .sidebarblock h5.subheader, .sidebarblock h6.subheader { line-height: 1.4; }
.sidebarblock > .content > .title { color: #003b6b; margin-top: 0; line-height: 1.6; }

.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }

.literalblock pre:not([class]), .listingblock pre:not([class]) { background: #eeeeee; }
.literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { border-width: 1px; border-style: dashed; border-color: #666666; -webkit-border-radius: 0; border-radius: 0; padding: 1.25em 1.5625em 1.125em 1.5625em; word-wrap: break-word; }
.literalblock pre.nowrap, .literalblock pre[class].nowrap, .listingblock pre.nowrap, .listingblock pre[class].nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
.literalblock pre > code, .literalblock pre[class] > code, .listingblock pre > code, .listingblock pre[class] > code { display: block; }
@media only screen { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.72em; } }
@media only screen and (min-width: 768px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.81em; } }
@media only screen and (min-width: 1280px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.9em; } }

.listingblock pre.highlight { padding: 0; }
.listingblock pre.highlight > code { padding: 1.25em 1.5625em 1.125em 1.5625em; }

.listingblock > .content { position: relative; }

.listingblock:hover code[class*=" language-"]:before { text-transform: uppercase; font-size: 0.9em; color: #999; position: absolute; top: 0.375em; right: 0.375em; }

.listingblock:hover code.asciidoc:before { content: "asciidoc"; }
.listingblock:hover code.clojure:before { content: "clojure"; }
.listingblock:hover code.css:before { content: "css"; }
.listingblock:hover code.groovy:before { content: "groovy"; }
.listingblock:hover code.html:before { content: "html"; }
.listingblock:hover code.java:before { content: "java"; }
.listingblock:hover code.javascript:before { content: "javascript"; }
.listingblock:hover code.python:before { content: "python"; }
.listingblock:hover code.ruby:before { content: "ruby"; }
.listingblock:hover code.sass:before { content: "sass"; }
.listingblock:hover code.scss:before { content: "scss"; }
.listingblock:hover code.xml:before { content: "xml"; }
.listingblock:hover code.yaml:before { content: "yaml"; }

.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }

.listingblock.terminal pre .command:not([data-prompt]):before { content: '$'; }

table.pyhltable { border: 0; margin-bottom: 0; }

table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; }

table.pyhltable td.code { padding-left: .75em; padding-right: 0; }

.highlight.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #dddddd; }

.highlight.pygments .lineno { display: inline-block; margin-right: .25em; }

table.pyhltable .linenodiv { background-color: transparent !important; padding-right: 0 !important; }

.quoteblock { margin: 0 0 0.75em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
.quoteblock blockquote { margin: 0 0 0.75em 0; padding: 0 0 0.5625em 0; border: 0; }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: -.25em; padding-bottom: 0.5625em; font-size: 0.8125em; color: #e15200; }
.quoteblock .attribution br { display: none; }
.quoteblock .attribution cite { display: block; margin-bottom: 0.625em; }

table thead th, table tfoot th { font-weight: bold; }

table.tableblock.grid-all { border-collapse: separate; border-spacing: 1px; -webkit-border-radius: 0; border-radius: 0; border-top: 1px solid #dddddd; border-bottom: 1px solid #dddddd; }

table.tableblock.frame-topbot, table.tableblock.frame-none { border-left: 0; border-right: 0; }

table.tableblock.frame-sides, table.tableblock.frame-none { border-top: 0; border-bottom: 0; }

table.tableblock td .paragraph:last-child p > p:last-child, table.tableblock th > p:last-child, table.tableblock td > p:last-child { margin-bottom: 0; }

th.tableblock.halign-left, td.tableblock.halign-left { text-align: left; }

th.tableblock.halign-right, td.tableblock.halign-right { text-align: right; }

th.tableblock.halign-center, td.tableblock.halign-center { text-align: center; }

th.tableblock.valign-top, td.tableblock.valign-top { vertical-align: top; }

th.tableblock.valign-bottom, td.tableblock.valign-bottom { vertical-align: bottom; }

th.tableblock.valign-middle, td.tableblock.valign-middle { vertical-align: middle; }

tbody tr th { display: table-cell; line-height: 1.4; background: -webkit-linear-gradient(top, #add386, #90b66a); }

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p { color: white; font-weight: bold; }

td > div.verse { white-space: pre; }

ol { margin-left: 1.75em; }

ul li ol { margin-left: 1.5em; }

dl dd { margin-left: 1.125em; }

dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.375em; }

ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }

ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }

ul.checklist li > p:first-child > i[class^="icon-check"]:first-child, ul.checklist li > p:first-child > input[type="checkbox"]:first-child { margin-right: 0.25em; }

ul.checklist li > p:first-child > input[type="checkbox"]:first-child { position: relative; top: 1px; }

ul.inline { margin: 0 auto 0.375em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }

.unstyled dl dt { font-weight: normal; font-style: normal; }

ol.arabic { list-style-type: decimal; }

ol.decimal { list-style-type: decimal-leading-zero; }

ol.loweralpha { list-style-type: lower-alpha; }

ol.upperalpha { list-style-type: upper-alpha; }

ol.lowerroman { list-style-type: lower-roman; }

ol.upperroman { list-style-type: upper-roman; }

ol.lowergreek { list-style-type: lower-greek; }

.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }

td.hdlist1 { padding-right: .8em; font-weight: bold; }

td.hdlist1, td.hdlist2 { vertical-align: top; }

.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }

.colist > table tr > td:first-of-type { padding: 0 .8em; line-height: 1; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }

.qanda > ol > li > p > em:only-child { color: #004985; }

.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }

.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }

.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }

a.image { text-decoration: none; }

span.footnote, span.footnoteref { vertical-align: super; font-size: 0.875em; }
span.footnote a, span.footnoteref a { text-decoration: none; }

#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -.25em 0 .75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em; line-height: 1.3; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.2em; margin-bottom: .2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }

#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }

.gist .file-data > table { border: none; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }

div.unbreakable { page-break-inside: avoid; }

.big { font-size: larger; }

.small { font-size: smaller; }

.underline { text-decoration: underline; }

.overline { text-decoration: overline; }

.line-through { text-decoration: line-through; }

.aqua { color: #00bfbf; }

.aqua-background { background-color: #00fafa; }

.black { color: black; }

.black-background { background-color: black; }

.blue { color: #0000bf; }

.blue-background { background-color: #0000fa; }

.fuchsia { color: #bf00bf; }

.fuchsia-background { background-color: #fa00fa; }

.gray { color: #606060; }

.gray-background { background-color: #7d7d7d; }

.green { color: #006000; }

.green-background { background-color: #007d00; }

.lime { color: #00bf00; }

.lime-background { background-color: #00fa00; }

.maroon { color: #600000; }

.maroon-background { background-color: #7d0000; }

.navy { color: #000060; }

.navy-background { background-color: #00007d; }

.olive { color: #606000; }

.olive-background { background-color: #7d7d00; }

.purple { color: #600060; }

.purple-background { background-color: #7d007d; }

.red { color: #bf0000; }

.red-background { background-color: #fa0000; }

.silver { color: #909090; }

.silver-background { background-color: #bcbcbc; }

.teal { color: #006060; }

.teal-background { background-color: #007d7d; }

.white { color: #bfbfbf; }

.white-background { background-color: #fafafa; }

.yellow { color: #bfbf00; }

.yellow-background { background-color: #fafa00; }

span.icon > [class^="icon-"], span.icon > [class*=" icon-"] { cursor: default; }

.admonitionblock td.icon [class^="icon-"]:before { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #00579e; color: #004176; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }

.conum { display: inline-block; color: white !important; background-color: black; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; width: 20px; height: 20px; font-size: 12px; font-weight: bold; line-height: 20px; font-family: Arial, sans-serif; font-style: normal; position: relative; top: -2px; letter-spacing: -1px; }
.conum * { color: white !important; }
.conum + b { display: none; }
.conum:after { content: attr(data-value); }
.conum:not([data-value]):empty { display: none; }

h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { border-bottom: 1px solid #dddddd; }

#toctitle { color: #00406F; font-weight: normal; margin-top: 1.5em; }

.sidebarblock { border-color: #aaa; }

code { -webkit-border-radius: 4px; border-radius: 4px; }

p.tableblock.header { color: #6d6e71; }</style><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/3.2.0/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/sunburst.min.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script><script>hljs.initHighlightingOnLoad()</script></head><body class="article toc2 toc-left"><div id="header"><h1>Performance Lab</h1><div id="toc" class="toc2"><div id="toctitle">Table of Contents</div><ul class="sectlevel1">
<li><a href="#_bare_metal_performance_lab">1. Bare Metal Performance Lab</a></li>
<li>
<ul class="sectlevel3">
<li><a href="#_review_server_resources">1.1. Review server resources</a></li>
<li><a href="#_review_ethernet_cards">1.2. Review Ethernet cards</a></li>
<li><a href="#_monitoring_network_data_processing">1.3. Monitoring network data processing</a></li>
</ul>
</li>
<li><a href="#_enable_virtual_functions">2. Enable Virtual Functions</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_sr_iov_virtual_function_pci_passthrough_device_just_as_information">2.1. SR-IOV Virtual Function PCI Passthrough Device (JUST AS INFORMATION)</a></li>
<li><a href="#_sr_iov_virtual_network_adapter_pool_just_information">2.2. SR-IOV Virtual Network Adapter Pool (JUST INFORMATION)</a></li>
</ul>
</li>
<li><a href="#_numa_isolate_cpu_and_hugepages_labs">3. NUMA, Isolate CPU and Hugepages Labs</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_intel_memory_latency_checker">3.1. Intel® Memory Latency Checker</a></li>
<li><a href="#_cpu_distribution_and_affinity">3.2. CPU distribution and Affinity</a></li>
<li><a href="#_isolate_cpus">3.3. Isolate CPUs</a></li>
<li><a href="#_huge_pages">3.4. Huge Pages</a></li>
</ul>
</li>
</ul></div></div><div id="content"><div id="preamble"><div class="sectionbody"><div class="paragraph"><p>In this lab, you will work with a colleague to reach the best performance between your servers using 10Gb Ethernet cards.</p></div>
<div class="paragraph"><p>In this lab:</p></div>
<div class="ulist"><ul><li><p>Configure and tune physical interface for best performance</p></li><li><p>Configure bare metal node for SRIOV</p></li><li><p>Configure Virtual Function interface for best performance</p></li><li><p>Create a VM assigned to SRIOV</p></li><li><p>Run TRex as a traffic generator</p></li><li><p>Use <code>testpmd</code>/<code>pktgen</code> for benchmark and traffic generator</p></li></ul></div></div></div>
<div class="sect1"><h2 id="_bare_metal_performance_lab">1. Bare Metal Performance Lab</h2><div class="sectionbody"><div class="paragraph"><p>You use one physical server to perform this lab. The server has two different dual-port Ethernet cards. You will review the server&#8217;s hardware and select the appropriate 10Gb network adapter for the performance testing.</p></div>
<div class="sect3"><h4 id="_review_server_resources">1.1. Review server resources</h4><div class="olist arabic"><ol class="arabic"><li><p>List data about the server&#8217;s CPUs:</p><div class="listingblock"><div class="content"><pre class="nowrap">[root@pool17-iad ~]# lscpu</pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="nowrap">Architecture:          x86_64
CPU op-mode(s):        32-bit, 64-bit
Byte Order:            Little Endian
CPU(s):                32
On-line CPU(s) list:   0-31
Thread(s) per core:    2
Core(s) per socket:    8
Socket(s):             2
NUMA node(s):          2
Vendor ID:             GenuineIntel
CPU family:            6
Model:                 79
Model name:            Intel(R) Xeon(R) CPU E5-2620 v4 @ 2.10GHz
Stepping:              1
CPU MHz:               2643.457
CPU max MHz:           3000.0000
CPU min MHz:           1200.0000
BogoMIPS:              4200.46
Virtualization:        VT-x
L1d cache:             32K
L1i cache:             32K
L2 cache:              256K
L3 cache:              20480K
NUMA node0 CPU(s):     0-7,16-23
NUMA node1 CPU(s):     8-15,24-31
Flags:                 fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx pdpe1gb rdtscp lm constant_tsc arch_perfmon pebs bts rep_good nopl xtopology nonstop_tsc aperfmperf eagerfpu pni pclmulqdq dtes64 monitor ds_cpl vmx smx est tm2 ssse3 sdbg fma cx16 xtpr pdcm pcid dca sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand lahf_lm abm 3dnowprefetch epb cat_l3 cdp_l3 invpcid_single intel_ppin intel_pt ssbd ibrs ibpb stibp tpr_shadow vnmi flexpriority ept vpid fsgsbase tsc_adjust bmi1 hle avx2 smep bmi2 erms invpcid rtm cqm rdt_a rdseed adx smap xsaveopt cqm_llc cqm_occup_llc cqm_mbm_total cqm_mbm_local dtherm ida arat pln pts spec_ctrl intel_stibp flush_l1d</pre></div></div>
<div class="paragraph"><p>Notice from this output the following:</p></div>
<div class="ulist"><ul><li><p>The operating system recognizes 32 CPUs</p></li><li><p>The hardware has 2 CPU sockets</p><div class="ulist"><ul><li><p>There are 8 cores per socket</p></li><li><p>Hyper-threading is enabled and each core has 2 threads</p></li></ul></div></li><li><p>The NUMA topology has 2 nodes</p><div class="ulist"><ul><li><p>Each NUMA node has 16 assigned CPUs</p></li></ul></div></li><li><p>The VT-x hardware assisted virtualization is enabled</p></li></ul></div></li><li><p>Review memory characteristics:</p><div class="olist loweralpha"><ol class="loweralpha" type="a"><li><p>Get data about the physical memory:</p><div class="listingblock"><div class="content"><pre class="nowrap">[root@pool17-iad ~]# free -m</pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="nowrap">              total        used        free      shared  buff/cache   available
Mem:         257672       65846       38277          35      153548      190908
Swap:             0           0           0</pre></div></div></li><li><p>Get data about HugePages:</p><div class="listingblock"><div class="content"><pre class="nowrap">[root@pool17-iad ~]# grep ^HugePages /proc/meminfo</pre></div></div>
<div class="listingblock"><div class="content"><pre class="nowrap">HugePages_Total:       0
HugePages_Free:        0
HugePages_Rsvd:        0
HugePages_Surp:        0</pre></div></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="icon-note" title="Note"></i></td><td class="content">HugePages have not been configured yet.</td></tr></table></div></li></ol></div></li></ol></div></div>
<div class="sect3"><h4 id="_review_ethernet_cards">1.2. Review Ethernet cards</h4><div class="olist arabic"><ol class="arabic"><li><p>List PCI cards and filter out records about the network adapters:</p><div class="listingblock"><div class="content"><pre class="nowrap">[root@pool17-iad ~]# lspci | egrep -i --color 'network|ethernet'</pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="nowrap">01:00.0 Ethernet controller: Intel Corporation Ethernet Controller 10-Gigabit X540-AT2 (rev 01)
01:00.1 Ethernet controller: Intel Corporation Ethernet Controller 10-Gigabit X540-AT2 (rev 01)
02:00.0 Ethernet controller: Intel Corporation Ethernet Controller 10-Gigabit X540-AT2 (rev 01)
02:00.1 Ethernet controller: Intel Corporation Ethernet Controller 10-Gigabit X540-AT2 (rev 01)</pre></div></div></li><li><p>Obtain details about the network cards:</p><div class="listingblock"><div class="content"><pre class="nowrap">[root@pool17-iad ~]# lshw -class network</pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="nowrap">  *-network:0
       description: Ethernet interface
       product: Ethernet Controller 10-Gigabit X540-AT2
       vendor: Intel Corporation
       physical id: 0
       bus info: pci@0000:01:00.0
       logical name: eth0
       version: 01
       serial: 0c:c4:7a:a5:15:e4
       size: 1Gbit/s
       capacity: 10Gbit/s
       width: 64 bits
       clock: 33MHz
       capabilities: pm msi msix pciexpress vpd bus_master cap_list ethernet physical tp 100bt-fd 1000bt-fd 10000bt-fd autonegotiation
       configuration: autonegotiation=on broadcast=yes driver=ixgbe driverversion=5.1.0-k-rh7.7 duplex=full firmware=0x800003e2 latency=0 link=yes multicast=yes port=twisted pair slave=yes speed=1Gbit/s
       resources: irq:24 memory:c7c00000-c7dfffff ioport:6020(size=32) memory:c7e04000-c7e07fff memory:90000000-900fffff memory:90100000-901fffff
  *-network:1
       description: Ethernet interface
       product: Ethernet Controller 10-Gigabit X540-AT2
       vendor: Intel Corporation
       physical id: 0.1
       bus info: pci@0000:01:00.1
       logical name: eth1
       version: 01
       serial: 0c:c4:7a:a5:15:e5
       size: 1Gbit/s
       capacity: 10Gbit/s
       width: 64 bits
       clock: 33MHz
       capabilities: pm msi msix pciexpress vpd bus_master cap_list ethernet physical tp 100bt-fd 1000bt-fd 10000bt-fd autonegotiation
       configuration: autonegotiation=on broadcast=yes driver=ixgbe driverversion=5.1.0-k-rh7.7 duplex=full firmware=0x800003e2 latency=0 link=yes multicast=yes port=twisted pair slave=yes speed=1Gbit/s
       resources: irq:104 memory:c7a00000-c7bfffff ioport:6000(size=32) memory:c7e00000-c7e03fff memory:90200000-902fffff memory:90300000-903fffff
  *-network:0
       description: Ethernet interface
       product: Ethernet Controller 10-Gigabit X540-AT2
       vendor: Intel Corporation
       physical id: 0
       bus info: pci@0000:02:00.0
       logical name: eth2
       version: 01
       serial: 0c:c4:7a:a5:15:e4
       size: 1Gbit/s
       capacity: 10Gbit/s
       width: 64 bits
       clock: 33MHz
       capabilities: pm msi msix pciexpress bus_master cap_list ethernet physical tp 100bt-fd 1000bt-fd 10000bt-fd autonegotiation
       configuration: autonegotiation=on broadcast=yes driver=ixgbe driverversion=5.1.0-k-rh7.7 duplex=full firmware=0x800003e1 latency=0 link=yes multicast=yes port=twisted pair slave=yes speed=1Gbit/s
       resources: irq:26 memory:c7600000-c77fffff ioport:5020(size=32) memory:c7804000-c7807fff memory:90400000-904fffff memory:90500000-905fffff
  *-network:1
       description: Ethernet interface
       product: Ethernet Controller 10-Gigabit X540-AT2
       vendor: Intel Corporation
       physical id: 0.1
       bus info: pci@0000:02:00.1
       logical name: eth3
       version: 01
       serial: 0c:c4:7a:a5:15:e5
       size: 1Gbit/s
       capacity: 10Gbit/s
       width: 64 bits
       clock: 33MHz
       capabilities: pm msi msix pciexpress bus_master cap_list ethernet physical tp 100bt-fd 1000bt-fd 10000bt-fd autonegotiation
       configuration: autonegotiation=on broadcast=yes driver=ixgbe driverversion=5.1.0-k-rh7.7 duplex=full firmware=0x800003e1 latency=0 link=yes multicast=yes port=twisted pair slave=yes speed=1Gbit/s
       resources: irq:171 memory:c7400000-c75fffff ioport:5000(size=32) memory:c7800000-c7803fff memory:90600000-906fffff memory:90700000-907fffff

&lt;&lt;OMITTED&gt;&gt;</pre></div></div></li><li><p>Get data about the device using <code>lspci</code> (replace PCI slot id, if necessary):</p><div class="listingblock"><div class="content"><pre class="nowrap">[root@pool17-iad ~]#  lspci -v -s 01:00.0</pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="nowrap">01:00.0 Ethernet controller: Intel Corporation Ethernet Controller 10-Gigabit X540-AT2 (rev 01)
	Subsystem: Super Micro Computer Inc Device 0847
	Physical Slot: 0
	Flags: bus master, fast devsel, latency 0, IRQ 24, NUMA node 0
	Memory at c7c00000 (64-bit, prefetchable) [size=2M]
	I/O ports at 6020 [size=32]
	Memory at c7e04000 (64-bit, prefetchable) [size=16K]
	Capabilities: [40] Power Management version 3
	Capabilities: [50] MSI: Enable- Count=1/1 Maskable+ 64bit+
	Capabilities: [70] MSI-X: Enable+ Count=64 Masked-
	Capabilities: [a0] Express Endpoint, MSI 00
	Capabilities: [e0] Vital Product Data
	Capabilities: [100] Advanced Error Reporting
	Capabilities: [150] Alternative Routing-ID Interpretation (ARI)
	Capabilities: [160] Single Root I/O Virtualization (SR-IOV)
	Capabilities: [1d0] Access Control Services
	Kernel driver in use: ixgbe
	Kernel modules: ixgbe</pre></div></div>
<div class="paragraph"><p>Notice in the output the following:</p></div>
<div class="ulist"><ul><li><p>Device is in <strong>NUMA node 0</strong></p></li><li><p>Device has the capability for SR-IOV</p></li><li><p>The current driver in use for this device is <code>ixgbe</code></p></li></ul></div></li><li><p>Get data about this Ethernet device using <code>ethtool</code>:</p><div class="listingblock"><div class="content"><pre class="nowrap">[root@pool17-iad ~]# ethtool eth0</pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="nowrap">Settings for eth0:
	Supported ports: [ TP ]
	Supported link modes:   100baseT/Full
	                        1000baseT/Full
	                        10000baseT/Full
	Supported pause frame use: Symmetric
	Supports auto-negotiation: Yes
	Supported FEC modes: Not reported
	Advertised link modes:  100baseT/Full
	                        1000baseT/Full
	                        10000baseT/Full
	Advertised pause frame use: Symmetric
	Advertised auto-negotiation: Yes
	Advertised FEC modes: Not reported
	Speed: 1000Mb/s
	Duplex: Full
	Port: Twisted Pair
	PHYAD: 0
	Transceiver: internal
	Auto-negotiation: on
	MDI-X: Unknown
	Supports Wake-on: umbg
	Wake-on: g
	Current message level: 0x00000007 (7)
			       drv probe link
	Link detected: yes</pre></div></div>
<div class="paragraph"><p>Notice that the Ethernet device is attached to an active network port and operates with the 10Gbit/s speed in the full duplex mode.</p></div></li><li><p>Get information about the device driver and firmware:</p><div class="listingblock"><div class="content"><pre class="nowrap">[root@pool17-iad ~]# ethtool  -i eth0</pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="nowrap">driver: ixgbe
version: 5.1.0-k-rh7.7
firmware-version: 0x800003e2
expansion-rom-version:
bus-info: 0000:01:00.0
supports-statistics: yes
supports-test: yes
supports-eeprom-access: yes
supports-register-dump: yes
supports-priv-flags: yes</pre></div></div></li></ol></div></div>
<div class="sect2"><h3 id="_monitoring_network_data_processing">1.3. Monitoring network data processing</h3><div class="paragraph"><p>The <code>/proc/net/softnet_stat</code> output displays the Details of the Packets received based on CPU Cores.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Run bash script to make content readable</p><div class="listingblock"><div class="content"><pre class="nowrap">[root@pool17-iad ~]# curl https://raw.githubusercontent.com/majek/dump/master/how-to-receive-a-packet/softnet.sh| bash</pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="nowrap">cpu      total    dropped   squeezed  collision        rps flow_limit
  0    9471694          0          0          0          0          0
  1    9595872          0          0          0          0          0
  2    9815272          0          0          0          0          0
  3    9974211          0          0          0          0          0
  4   10075915          0          0          0          0          0
  5   10381156          0          0          0          0          0
  6   10618306          0          0          0          0          0
  7    9751498          0          0          0          0          0
  8   12301362          0          0          0          0          0
  9   12769885          0          0          0          0          0
 10   12840706          0          0          0          0          0
 11   12638001          0          0          0          0          0
 12   12839701          0          0          0          0          0
 13   12746998          0          0          0          0          0
 14   12715775          0          0          0          0          0
 15   13035528          0          0          0          0          0
 16    5762983          0          0          0          0          0
 17    5614863          0          0          0          0          0
 18    6304595          0          0          0          0          0
 19    5425902          0          0          0          0          0
 20   13937662          0          0          0          0          0
 21    6397719          0          0          0          0          0
 22   48842781          0          0          0          0          0
 23    5751866          0          0          0          0          0
 24    6393003          0          0          0          0          0
 25    6294753          0          0          0          0          0
 26    6287019          0          0          0          0          0
 27    6049977          0          0          0          0          0
 28    6436741          0          0          0          0          0
 29    6769138          0          0          0          0          0
 30    6193511          0          0          0          0          0
 31    6234508          0          0          0          0          0</pre></div></div></li></ol></div></div></div></div>
<div class="sect1"><h2 id="_enable_virtual_functions">2. Enable Virtual Functions</h2><div class="sectionbody"><div class="paragraph"><p>Your physical server has a network card supporting SR-IOV. In this lab, you enable <em>Virtual Functions</em> (VFs) on this card and configure one of them to be used for performance testing instead of the <em>Physical Function</em> (PV) you used before.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Check the current number of VFs:</p><div class="listingblock"><div class="content"><pre class="nowrap">[root@pool17-iad ~]# cat /sys/class/net/eth2/device/sriov_numvfs</pre></div></div>
<div class="listingblock"><div class="title">Expected Output</div><div class="content"><pre class="nowrap">0</pre></div></div></li><li><p>Check the maximum number of VFs supported on this device:</p><div class="listingblock"><div class="content"><pre class="nowrap">[root@pool17-iad ~]#  cat /sys/class/net/eth2/device/sriov_totalvfs</pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="nowrap">63</pre></div></div></li><li><p>Enable 5 VFs on the device:</p><div class="listingblock"><div class="content"><pre class="nowrap">[root@pool17-iad ~]# echo 5 &gt; /sys/class/net/eth2/device/sriov_numvfs</pre></div></div></li><li><p>List the VFs assigned to eth2:</p><div class="listingblock"><div class="content"><pre class="nowrap">[root@pool17-iad ~]# ip link show eth2</pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="nowrap">4: eth2: &lt;BROADCAST,MULTICAST,SLAVE,UP,LOWER_UP&gt; mtu 9000 qdisc mq master bond0 state UP mode DEFAULT group default qlen 1000
    link/ether 0c:c4:7a:a5:15:e4 brd ff:ff:ff:ff:ff:ff
    vf 0 MAC d6:16:c5:15:03:a7, spoof checking on, link-state auto, trust off, query_rss off
    vf 1 MAC 9e:b7:b6:8e:f9:f0, spoof checking on, link-state auto, trust off, query_rss off
    vf 2 MAC 12:8f:1b:a7:fb:c9, spoof checking on, link-state auto, trust off, query_rss off
    vf 3 MAC 52:f6:f7:b4:61:43, spoof checking on, link-state auto, trust off, query_rss off
    vf 4 MAC fe:a6:2a:58:62:c2, spoof checking on, link-state auto, trust off, query_rss off</pre></div></div></li><li><p>List the new devices representing VFs:</p><div class="listingblock"><div class="content"><pre class="nowrap">[root@compute-student02 ~]# ip link | tail</pre></div></div>
<div class="listingblock"><div class="content"><pre class="nowrap">[root@pool17-iad ~]# ip link | tail
225: eth4: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP mode DEFAULT group default qlen 1000
    link/ether d6:16:c5:15:03:a7 brd ff:ff:ff:ff:ff:ff
226: eth5: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP mode DEFAULT group default qlen 1000
    link/ether 9e:b7:b6:8e:f9:f0 brd ff:ff:ff:ff:ff:ff
227: eth6: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP mode DEFAULT group default qlen 1000
    link/ether 12:8f:1b:a7:fb:c9 brd ff:ff:ff:ff:ff:ff
228: eth7: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP mode DEFAULT group default qlen 1000
    link/ether 52:f6:f7:b4:61:43 brd ff:ff:ff:ff:ff:ff
229: eth8: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP mode DEFAULT group default qlen 1000
    link/ether fe:a6:2a:58:62:c2 brd ff:ff:ff:ff:ff:ff</pre></div></div></li></ol></div>
<div class="sect2"><h3 id="_sr_iov_virtual_function_pci_passthrough_device_just_as_information">2.1. SR-IOV Virtual Function PCI Passthrough Device (JUST AS INFORMATION)</h3><div class="olist arabic"><ol class="arabic"><li><p>Get the PCI bus information for the VFs:</p><div class="listingblock"><div class="content"><pre class="nowrap">[root@compute-student02 ~]# lshw -c network -businfo</pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="nowrap">&lt;&lt;OMITTED&gt;&gt;
pci@0000:02:10.0  eth4        network        X540 Ethernet Controller Virtual Function
pci@0000:02:10.2  eth5        network        X540 Ethernet Controller Virtual Function
pci@0000:02:10.4  eth6        network        X540 Ethernet Controller Virtual Function
pci@0000:02:10.6  eth7        network        X540 Ethernet Controller Virtual Function
pci@0000:02:11.0  eth8        network        X540 Ethernet Controller Virtual Function
&lt;&lt;OMITTED&gt;&gt;</pre></div></div>
<div class="paragraph"><p>Notice the bus info related to the <code>p6p1_0</code> virtual function.</p></div></li></ol></div>
<div class="admonitionblock important"><table><tr><td class="icon"><i class="icon-important" title="Important"></i></td><td class="content">JUST AS INFORMATION don&#8217;t do it</td></tr></table></div>
<div class="olist arabic"><ol class="arabic"><li><p>Generate the <code>rhel.xml</code> file containing the definition of a VM with one network interface attached to the <code>default</code> libvirt network and another interface implemented as a PCI passthrough of the <code>p6p1_0</code> VF:</p><div class="listingblock"><div class="content"><pre class="nowrap">[root@compute-student02 home]# virt-install --ram 6096 --vcpus 4 \
 --os-variant rhel7 --disk path=rhel.qcow2,device=disk,bus=virtio,format=qcow2  \
 --noautoconsole --vnc  --network network:default  --name rhel \
  --host-device=pci_0000_02_10_0  \
  --cpu host,+vmx --dry-run --print-xml | tee rhel.xml</pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="nowrap">&lt;&lt;OMITTED&gt;&gt;
&lt;interface type="network"&gt;
  &lt;source network="default"/&gt;
  &lt;mac address="52:54:00:c4:24:ac"/&gt;
  &lt;model type="virtio"/&gt;
&lt;/interface&gt;
&lt;&lt;OMITTED&gt;&gt;
    &lt;hostdev mode="subsystem" type="pci" managed="yes"&gt;
      &lt;source&gt;
        &lt;address domain="0" bus="6" slot="2" function="0"/&gt;
      &lt;/source&gt;
    &lt;/hostdev&gt;
  &lt;/devices&gt;
&lt;/domain&gt;</pre></div></div></li><li><p>Define the <code>rhel</code> VM:</p><div class="listingblock"><div class="content"><pre class="nowrap">[root@compute-student02 ~]# virsh define --file rhel.xml</pre></div></div>
<div class="listingblock"><div class="title">Expected Output</div><div class="content"><pre class="nowrap">Domain rhel defined from rhel.xml</pre></div></div></li><li><p>Start the <code>rhel</code> VM:</p><div class="listingblock"><div class="content"><pre class="nowrap">[root@compute-student02 ~]# virsh start rhel</pre></div></div>
<div class="listingblock"><div class="title">Expected Output</div><div class="content"><pre class="nowrap">error: Failed to start domain rhel
error: unsupported configuration: host doesn't support passthrough of host PCI devices</pre></div></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="icon-note" title="Note"></i></td><td class="content">The error message is expected. It demonstrates that the host needs to be prepared to enable PCI passthrough.</td></tr></table></div></li><li><p>Enable IOMMU in the host kernel:</p><div class="listingblock"><div class="content"><pre class="nowrap">[root@compute-student02 home]# sed -i 's/quiet/quiet intel_iommu=on iommu=pt /' /etc/default/grub
[root@compute-student02 home]# grub2-mkconfig -o /boot/grub2/grub.cfg</pre></div></div></li><li><p>Reboot the system:</p><div class="listingblock"><div class="content"><pre class="nowrap">[root@compute-student02 ~]# shutdown -r now</pre></div></div></li><li><p>Enable VFs and start the VM:</p><div class="listingblock"><div class="content"><pre class="nowrap">[root@compute-student02 ~]# echo 1 &gt; /sys/class/net/eth2/device/sriov_numvfs
[root@compute-student02 ~]# echo 1 &gt; /sys/class/net/eth2/device/sriov_numvfs
[root@compute-student02 ~]# virsh start rhel</pre></div></div>
<div class="listingblock"><div class="title">Expected Output</div><div class="content"><pre class="nowrap">Domain rhel started</pre></div></div></li><li><p>Login to the vm using the <code>root</code> account and the <code>r3dh4t1!</code> password:</p><div class="listingblock"><div class="content"><pre class="nowrap">[root@compute-student02 ~]# virsh console rhel</pre></div></div></li><li><p>List network devices visible inside the VM:</p><div class="listingblock"><div class="content"><pre class="nowrap">[root@localhost ~]# lshw -c network</pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="nowrap">*-network:0
     description: Ethernet controller
     product: Virtio network device
     vendor: Red Hat, Inc.
     physical id: 3
     bus info: pci@0000:00:03.0
     version: 00
     width: 64 bits
     clock: 33MHz
     capabilities: msix bus_master cap_list rom
     configuration: driver=virtio-pci latency=0
     resources: irq:11 ioport:c080(size=32) memory:febd1000-febd1fff memory:fe010000-fe013fff memory:feb80000-febbffff
   *-virtio0
        description: Ethernet interface
        physical id: 0
        bus info: virtio@0
        logical name: eth1
        serial: 52:54:00:8f:cb:c5
        capabilities: ethernet physical
        configuration: broadcast=yes driver=virtio_net driverversion=1.0.0 link=yes multicast=yes
*-network:1
     description: Ethernet interface
     product: Ethernet Virtual Function 700 Series
     vendor: Intel Corporation
     physical id: 7
     bus info: pci@0000:00:07.0
     logical name: eth0
     version: 01
     serial: 82:7d:98:95:8a:49
     size: 10Gbit/s
     width: 64 bits
     clock: 33MHz
     capabilities: msix pciexpress bus_master cap_list ethernet physical
     configuration: autonegotiation=off broadcast=yes driver=i40evf driverversion=3.2.2-k duplex=full firmware=N/A latency=0 link=yes multicast=yes speed=10Gbit/s
     resources: irq:0 memory:fe000000-fe00ffff memory:fe01c000-fe01ffff</pre></div></div></li></ol></div></div>
<div class="sect2"><h3 id="_sr_iov_virtual_network_adapter_pool_just_information">2.2. SR-IOV Virtual Network Adapter Pool (JUST INFORMATION)</h3><div class="admonitionblock important"><table><tr><td class="icon"><i class="icon-important" title="Important"></i></td><td class="content">JUST AS INFORMATION don&#8217;t do it</td></tr></table></div>
<div class="olist arabic"><ol class="arabic"><li><p>Check current interfaces on baremetal node</p><div class="listingblock"><div class="content"><pre class="nowrap">[root@compute-student02 ~]# ip l</pre></div></div>
<div class="paragraph"><p>Notice from output p6p1_0 is not shown, as is assigned to the VM.</p></div></li><li><p>Destroy previous created VM</p><div class="listingblock"><div class="content"><pre class="nowrap">[root@compute-student02 ~]# virsh destroy rhel
viDomain rhel destroyed

[root@compute-student02 ~]# virsh undefine rhel
Domain rhel has been undefined</pre></div></div></li><li><p>Check again the interfaces</p><div class="listingblock"><div class="content"><pre class="nowrap">[root@compute-student02 ~]# ip l</pre></div></div>
<div class="paragraph"><p>Notice from output p6p1_0 is shown again.</p></div></li><li><p>Increase the number of VF to 5</p><div class="listingblock"><div class="content"><pre class="nowrap">[root@compute-student02 home]# echo 0 &gt; /sys/class/net/p6p1/device/sriov_numvfs
[root@compute-student02 home]# echo 5 &gt; /sys/class/net/p6p1/device/sriov_numvfs</pre></div></div></li><li><p>Create network definition to use forward mode</p><div class="listingblock"><div class="content"><pre class="nowrap">[root@compute-student02 home]# cat &gt; net-p6p1.xml &lt;&lt; EOF
&lt;network&gt;
 &lt;name&gt;net-p6p1&lt;/name&gt;
  &lt;forward mode='hostdev' managed='yes'&gt;
  &lt;pf dev='p6p1'/&gt;
 &lt;/forward&gt;
&lt;/network&gt;
EOF
[root@compute-student02 home]# cat &gt; net-p6p2.xml &lt;&lt; EOF
&lt;network&gt;
 &lt;name&gt;net-p6p2&lt;/name&gt;
  &lt;forward mode='hostdev' managed='yes'&gt;
  &lt;pf dev='p6p2'/&gt;
 &lt;/forward&gt;
&lt;/network&gt;
EOF</pre></div></div></li><li><p>Define network using the file</p><div class="listingblock"><div class="content"><pre class="nowrap">[root@compute-student02 ~]# virsh net-define  net-p6p1.xml
[root@compute-student02 ~]# virsh net-define  net-p6p2.xml</pre></div></div>
<div class="listingblock"><div class="title">Expected Output</div><div class="content"><pre class="nowrap">Network net-p6p1 defined from net-p6p1.xml
Network net-p6p2 defined from net-p6p2.xml</pre></div></div></li><li><p>Start network</p><div class="listingblock"><div class="content"><pre class="nowrap">[root@compute-student02 home]# virsh net-start net-p6p1
[root@compute-student02 home]# virsh net-start net-p6p2</pre></div></div>
<div class="listingblock"><div class="title">Expected Output</div><div class="content"><pre class="nowrap">Network net-p6p1 started
Network net-p6p2 started</pre></div></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="icon-note" title="Note"></i></td><td class="content">Network <code>net-p6p2</code> will be used in further tasks.</td></tr></table></div></li><li><p>Create VM definition using network</p><div class="listingblock"><div class="content"><pre class="nowrap">[root@compute-student02 ~]# cd /home
[root@compute-student02 home]# virt-install --ram 6096 --vcpus 4 --os-variant rhel7  --disk path=rhel.qcow2,device=disk,bus=virtio,format=qcow2  --noautoconsole --vnc  --network network:net-p6p1  --name rhel2  --cpu host,+vmx --dry-run --print-xml | tee rhel2.xml</pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="nowrap">&lt;&lt;OMITTED&gt;&gt;
&lt;interface type="network"&gt;
  &lt;source network="net-p6p1"/&gt;
  &lt;mac address="52:54:00:3e:e2:ac"/&gt;
  &lt;model type="virtio"/&gt;
&lt;/interface&gt;
&lt;&lt;OMITTED&gt;&gt;</pre></div></div></li><li><p>Add VM and start VM</p><div class="listingblock"><div class="content"><pre class="nowrap">[root@compute-student02 home]# virsh define rhel2.xml
Domain rhel2 defined from rhel2.xml

[root@compute-student02 home]# virsh start rhel2
Domain rhel2 started</pre></div></div></li><li><p>List virtual network interfaces</p><div class="listingblock"><div class="content"><pre class="nowrap">[root@compute-student02 home]# ip link show p6p1</pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="nowrap">2: p6p1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 9000 qdisc mq state UP mode DEFAULT group default qlen 1000
    link/ether 3c:fd:fe:cf:09:ac brd ff:ff:ff:ff:ff:ff
    vf 0 MAC 52:54:00:d0:32:fc, spoof checking on, link-state auto, trust off
    vf 1 MAC 00:00:00:00:00:00, spoof checking on, link-state auto, trust off
    vf 2 MAC 00:00:00:00:00:00, spoof checking on, link-state auto, trust off
    vf 3 MAC 00:00:00:00:00:00, spoof checking on, link-state auto, trust off
    vf 4 MAC 00:00:00:00:00:00, spoof checking on, link-state auto, trust off</pre></div></div></li><li><p>Connect to the VM and check interfaces</p><div class="listingblock"><div class="content"><pre class="nowrap">[root@compute-student02 home]# virsh console rhel2
[root@localhost ~]# ip link show eth0</pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="nowrap">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP mode DEFAULT group default qlen 1000
    link/ether 52:54:00:d0:32:fc brd ff:ff:ff:ff:ff:ff</pre></div></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="icon-note" title="Note"></i></td><td class="content">Notice the MAC address corresponds to the "vf 0 MAC"</td></tr></table></div></li></ol></div></div></div></div>
<div class="sect1"><h2 id="_numa_isolate_cpu_and_hugepages_labs">3. NUMA, Isolate CPU and Hugepages Labs</h2><div class="sectionbody"><div class="sect2"><h3 id="_intel_memory_latency_checker">3.1. Intel® Memory Latency Checker</h3><div class="paragraph"><p>Intel® Memory Latency Checker (Intel® MLC) is a tool used to measure memory latencies and b/w, and how they change with increasing load on the system. It also provides several options for more fine-grained investigation where b/w and latencies from a specific set of cores to caches or memory can be measured as well.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Download and extract <code>MLC</code></p><div class="listingblock"><div class="content"><pre class="nowrap">[root@compute-student02 ~]# curl -O https://software.intel.com/content/dam/develop/external/us/en/protected/mlc_v3.8.tgz
[root@compute-student02 ~]# tar xvfz mlc_v3.8.tgz Linux/mlc</pre></div></div></li><li><p>Print a matrix of local and cross-socket memory latencies</p><div class="listingblock"><div class="content"><pre class="nowrap">[root@compute-student02 ~]# Linux/mlc --latency_matrix</pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="nowrap">Intel(R) Memory Latency Checker - v3.7
Command line parameters: --latency_matrix

Using buffer size of 200.000MiB
Measuring idle latencies (in ns)...
		Numa node
Numa node	     0	     1
       0	  77.9	 122.4
       1	 122.8	  76.8</pre></div></div></li><li><p>Prints a matrix of local and cross-socket memory bandwidths</p><div class="listingblock"><div class="content"><pre class="nowrap">[root@compute-student02 ~]# Linux/mlc --bandwidth_matrix</pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="nowrap">Intel(R) Memory Latency Checker - v3.7
Command line parameters: --bandwidth_matrix

Using buffer size of 100.000MiB/thread for reads and an additional 100.000MiB/thread for writes
Measuring Memory Bandwidths between nodes within system
Bandwidths are in MB/sec (1 MB/sec = 1,000,000 Bytes/sec)
Using all the threads from each core if Hyper-threading is enabled
Using Read-only traffic type
		Numa node
Numa node	     0	     1
       0	27803.2	 6257.8
       1	 6233.3	27798.0</pre></div></div></li></ol></div></div>
<div class="sect2"><h3 id="_cpu_distribution_and_affinity">3.2. CPU distribution and Affinity</h3><div class="olist arabic"><ol class="arabic"><li><p>Install <code>hwloc</code> package</p><div class="listingblock"><div class="content"><pre class="nowrap">[root@compute-student02 ~]# yum install -y hwloc</pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="nowrap">&lt;&lt;OMITTED&gt;&gt;
Installed:
  hwloc.x86_64 0:1.11.8-4.el7

Dependency Installed:
  hwloc-libs.x86_64 0:1.11.8-4.el7                                                    libtool-ltdl.x86_64 0:2.4.2-22.el7_3

Complete!</pre></div></div></li><li><p>List CPU distribution</p><div class="listingblock"><div class="content"><pre class="nowrap">[root@compute-student01 home]# lstopo-no-graphics --no-io --no-legend --of txt --no-caches</pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="nowrap">┌──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│ Machine (128GB total)                                                                                                │
│                                                                                                                      │
│ ┌───────────────────────────────────────────────────────┐  ┌───────────────────────────────────────────────────────┐ │
│ │ ┌───────────────────────────────────────────────────┐ │  │ ┌───────────────────────────────────────────────────┐ │ │
│ │ │ NUMANode P#0 (64GB)                               │ │  │ │ NUMANode P#1 (64GB)                               │ │ │
│ │ └───────────────────────────────────────────────────┘ │  │ └───────────────────────────────────────────────────┘ │ │
│ │                                                       │  │                                                       │ │
│ │ ┌───────────────────────────────────────────────────┐ │  │ ┌───────────────────────────────────────────────────┐ │ │
│ │ │ Package P#0                                       │ │  │ │ Package P#1                                       │ │ │
│ │ │                                                   │ │  │ │                                                   │ │ │
│ │ │ ┌─────────────┐  ┌─────────────┐  ┌─────────────┐ │ │  │ │ ┌─────────────┐  ┌─────────────┐  ┌─────────────┐ │ │ │
│ │ │ │ Core P#0    │  │ Core P#1    │  │ Core P#2    │ │ │  │ │ │ Core P#0    │  │ Core P#1    │  │ Core P#2    │ │ │ │
│ │ │ │             │  │             │  │             │ │ │  │ │ │             │  │             │  │             │ │ │ │
│ │ │ │ ┌─────────┐ │  │ ┌─────────┐ │  │ ┌─────────┐ │ │ │  │ │ │ ┌─────────┐ │  │ ┌─────────┐ │  │ ┌─────────┐ │ │ │ │
│ │ │ │ │ PU P#0  │ │  │ │ PU P#2  │ │  │ │ PU P#4  │ │ │ │  │ │ │ │ PU P#1  │ │  │ │ PU P#3  │ │  │ │ PU P#5  │ │ │ │ │
│ │ │ │ └─────────┘ │  │ └─────────┘ │  │ └─────────┘ │ │ │  │ │ │ └─────────┘ │  │ └─────────┘ │  │ └─────────┘ │ │ │ │
│ │ │ │ ┌─────────┐ │  │ ┌─────────┐ │  │ ┌─────────┐ │ │ │  │ │ │ ┌─────────┐ │  │ ┌─────────┐ │  │ ┌─────────┐ │ │ │ │
│ │ │ │ │ PU P#12 │ │  │ │ PU P#14 │ │  │ │ PU P#16 │ │ │ │  │ │ │ │ PU P#13 │ │  │ │ PU P#15 │ │  │ │ PU P#17 │ │ │ │ │
│ │ │ │ └─────────┘ │  │ └─────────┘ │  │ └─────────┘ │ │ │  │ │ │ └─────────┘ │  │ └─────────┘ │  │ └─────────┘ │ │ │ │
│ │ │ └─────────────┘  └─────────────┘  └─────────────┘ │ │  │ │ └─────────────┘  └─────────────┘  └─────────────┘ │ │ │
│ │ │                                                   │ │  │ │                                                   │ │ │
│ │ │ ┌─────────────┐  ┌─────────────┐  ┌─────────────┐ │ │  │ │ ┌─────────────┐  ┌─────────────┐  ┌─────────────┐ │ │ │
│ │ │ │ Core P#3    │  │ Core P#4    │  │ Core P#5    │ │ │  │ │ │ Core P#3    │  │ Core P#4    │  │ Core P#5    │ │ │ │
│ │ │ │             │  │             │  │             │ │ │  │ │ │             │  │             │  │             │ │ │ │
│ │ │ │ ┌─────────┐ │  │ ┌─────────┐ │  │ ┌─────────┐ │ │ │  │ │ │ ┌─────────┐ │  │ ┌─────────┐ │  │ ┌─────────┐ │ │ │ │
│ │ │ │ │ PU P#6  │ │  │ │ PU P#8  │ │  │ │ PU P#10 │ │ │ │  │ │ │ │ PU P#7  │ │  │ │ PU P#9  │ │  │ │ PU P#11 │ │ │ │ │
│ │ │ │ └─────────┘ │  │ └─────────┘ │  │ └─────────┘ │ │ │  │ │ │ └─────────┘ │  │ └─────────┘ │  │ └─────────┘ │ │ │ │
│ │ │ │ ┌─────────┐ │  │ ┌─────────┐ │  │ ┌─────────┐ │ │ │  │ │ │ ┌─────────┐ │  │ ┌─────────┐ │  │ ┌─────────┐ │ │ │ │
│ │ │ │ │ PU P#18 │ │  │ │ PU P#20 │ │  │ │ PU P#22 │ │ │ │  │ │ │ │ PU P#19 │ │  │ │ PU P#21 │ │  │ │ PU P#23 │ │ │ │ │
│ │ │ │ └─────────┘ │  │ └─────────┘ │  │ └─────────┘ │ │ │  │ │ │ └─────────┘ │  │ └─────────┘ │  │ └─────────┘ │ │ │ │
│ │ │ └─────────────┘  └─────────────┘  └─────────────┘ │ │  │ │ └─────────────┘  └─────────────┘  └─────────────┘ │ │ │
│ │ └───────────────────────────────────────────────────┘ │  │ └───────────────────────────────────────────────────┘ │ │
│ └───────────────────────────────────────────────────────┘  └───────────────────────────────────────────────────────┘ │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘</pre></div></div></li><li><p>Install <code>numactl</code></p><div class="listingblock"><div class="content"><pre class="nowrap">[root@compute-student02 ~]# yum install -y numactl</pre></div></div></li><li><p>Run <code>numactl</code> to obtain information</p><div class="listingblock"><div class="content"><pre class="nowrap">[root@compute-student02 ~]# numactl --hardware</pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="nowrap">available: 2 nodes (0-1)
node 0 cpus: 0 2 4 6 8 10 12 14 16 18 20 22
node 0 size: 65442 MB
node 0 free: 63579 MB
node 1 cpus: 1 3 5 7 9 11 13 15 17 19 21 23
node 1 size: 65536 MB
node 1 free: 63806 MB
node distances:
node   0   1
  0:  10  21
  1:  21  10</pre></div></div></li><li><p>Check current CPUS for pid 1 (init)</p><div class="listingblock"><div class="content"><pre class="nowrap">[root@compute-student02 ~]# taskset -cp 1</pre></div></div>
<div class="listingblock"><div class="title">Expected Output</div><div class="content"><pre class="nowrap">pid 1's current affinity list: 0-31</pre></div></div></li><li><p>List the distribution of the number of processes and the CPU assigned</p><div class="listingblock"><div class="content"><pre class="nowrap">[root@compute-student01 ~]# ps -eF h|fgrep -v -e kworker -e ksoft -e migration -e watchdog -e kthread |awk '{print $7}'|sort|uniq -c</pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="nowrap">      9 0
      7 1
     10 10
      6 11
      2 12
      1 13
      5 14
     23 15
      4 16
     12 17
      5 18
      4 19
      7 2
      3 20
      2 21
      4 22
      3 23
      2 3
      2 4
      5 5
      2 6
      9 7
      4 8
      6 9</pre></div></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="icon-note" title="Note"></i></td><td class="content">First column is the number of processes and the second the CPU id</td></tr></table></div></li></ol></div></div>
<div class="sect2"><h3 id="_isolate_cpus">3.3. Isolate CPUs</h3><div class="paragraph"><p>For our example we will isolate all the CPUs except 0 and 12 from Socket 0 and 1 and 13 from Socket 1. The rest of CPUs are not going to be used by the Linux scheduler for tasks.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Add the parameter <code>isolcpus</code> to the kernel arguments, reboot the system</p><div class="listingblock"><div class="content"><pre class="nowrap">[root@compute-student02 ~]# sed -i 's/net.ifnames=0/net.ifnames=0 isolcpus=1-7,9-15,17-23,25-31/' /etc/default/grub
[root@compute-student02 ~]# grub2-mkconfig -o /boot/grub2/grub.cfg
[root@compute-student02 ~]# shutdown -r now</pre></div></div></li><li><p>Check again the CPUs</p><div class="listingblock"><div class="content"><pre class="nowrap">[root@compute-student02 ~]# taskset -cp 1</pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="nowrap">pid 1's current affinity list: 0,1,12,13</pre></div></div></li><li><p>List the distribution of the number of processes and the CPU assigned</p><div class="listingblock"><div class="content"><pre class="nowrap">[root@compute-student02 ~]# ps -eF h|fgrep -v -e kworker -e ksoft -e migration -e watchdog -e kthread |awk '{print $7}'|sort|uniq -c</pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="nowrap">     35 0
     19 1
     35 12
     40 13</pre></div></div></li></ol></div></div>
<div class="sect2"><h3 id="_huge_pages">3.4. Huge Pages</h3><div class="olist arabic"><ol class="arabic"><li><p>Enable HugePages</p><div class="listingblock"><div class="content"><pre class="nowrap">[root@compute-student02 ~]# sysctl vm.nr_hugepages=5000</pre></div></div></li><li><p>Check current status</p><div class="listingblock"><div class="content"><pre class="nowrap">[root@compute-student02 ~]# grep Huge /proc/meminfo</pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="nowrap">AnonHugePages:      8192 kB
HugePages_Total:    5000
HugePages_Free:     5000
HugePages_Rsvd:        0
HugePages_Surp:        0
Hugepagesize:       2048 kB</pre></div></div></li><li><p>Check the Transparent HugePages status (THP):</p><div class="listingblock"><div class="content"><pre class="nowrap">[root@compute-student02 ~]# cat /sys/kernel/mm/transparent_hugepage/enabled</pre></div></div>
<div class="listingblock"><div class="title">Expected Output</div><div class="content"><pre class="nowrap">[always] madvise never</pre></div></div></li><li><p>Configure kernel to disable Transparent HugePages (THP) and enable HugePages:</p><div class="listingblock"><div class="content"><pre class="nowrap">[root@compute-student02 ~]# sed -i 's/net.ifnames=0/net.ifnames=0 default_hugepagesz=1GB hugepagesz=1G hugepages=62 transparent_hugepage=never/' /etc/default/grub
[root@compute-student02 ~]# grub2-mkconfig -o /boot/grub2/grub.cfg
[root@compute-student02 ~]# shutdown -r now</pre></div></div></li><li><p>Check configuration after reboot:</p><div class="listingblock"><div class="content"><pre class="nowrap">[root@compute-student02 ~]# grep Huge /proc/meminfo</pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="nowrap">AnonHugePages:         0 kB
HugePages_Total:      62
HugePages_Free:       62
HugePages_Rsvd:        0
HugePages_Surp:        0
Hugepagesize:    1048576 kB</pre></div></div></li></ol></div></div></div></div></div><div id="footer"><div id="footer-text"><br>Build Version: 1.6.7   :   Last updated 2020-09-20 04:59:02 EDT</div></div></body></html>